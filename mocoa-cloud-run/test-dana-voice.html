<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dana Voice Test - Dr. Lucy</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            padding: 40px;
            text-align: center;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(11, 177, 187, 0.3);
        }
        .voice-info {
            background: rgba(11, 177, 187, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        button {
            background: linear-gradient(135deg, #0bb1bb, #50C878);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(11, 177, 187, 0.5);
        }
        .voice-list {
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .dana-found {
            color: #50C878;
            font-weight: bold;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        .success { background: rgba(80, 200, 120, 0.2); color: #50C878; }
        .error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéôÔ∏è Dana Voice Test for Dr. Lucy</h1>
        
        <div class="voice-info">
            <h3>Voice System Status:</h3>
            <div id="voiceStatus">Checking voice system...</div>
        </div>
        
        <button onclick="checkVoices()">üîç Check Available Voices</button>
        <button onclick="testDanaVoice()">üó£Ô∏è Test Dana Voice</button>
        <button onclick="testFallbackVoice()">‚ö° Test Best Female Voice</button>
        
        <div id="statusMessages"></div>
        
        <div class="voice-info">
            <h3>Available Voices:</h3>
            <div id="voiceList" class="voice-list">Loading voices...</div>
        </div>
    </div>

    <script>
        let voices = [];
        let danaVoice = null;
        let bestFemaleVoice = null;
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessages');
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.textContent = message;
            statusDiv.appendChild(status);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (status.parentNode) {
                    status.remove();
                }
            }, 5000);
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            console.log(`üîç Found ${voices.length} voices:`, voices);
            
            // Look for Dana voice specifically
            danaVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('dana') ||
                voice.name === 'Dana' ||
                voice.name.includes('Dana (Premium)')
            );
            
            // Look for best female voices as fallback
            const femaleVoices = [
                'Allison', 'Samantha', 'Victoria', 'Susan', 'Karen', 'Ava', 'Serena', 'Zoe',
                'Fiona', 'Moira', 'Tessa', 'Veena'
            ];
            
            for (const voiceName of femaleVoices) {
                bestFemaleVoice = voices.find(voice => 
                    voice.name.includes(voiceName)
                );
                if (bestFemaleVoice) break;
            }
            
            // Fallback to any English female voice
            if (!bestFemaleVoice) {
                bestFemaleVoice = voices.find(voice => 
                    voice.lang.startsWith('en') && 
                    (voice.name.toLowerCase().includes('female') || 
                     voice.name.toLowerCase().includes('woman'))
                ) || voices.find(voice => voice.lang.startsWith('en')) || voices[0];
            }
            
            updateVoiceDisplay();
        }
        
        function updateVoiceDisplay() {
            const statusDiv = document.getElementById('voiceStatus');
            const voiceListDiv = document.getElementById('voiceList');
            
            // Update status
            if (danaVoice) {
                statusDiv.innerHTML = `
                    <div class="dana-found">‚úÖ Dana voice found: ${danaVoice.name}</div>
                    <div>Language: ${danaVoice.lang}</div>
                    <div>Local: ${danaVoice.localService ? 'Yes' : 'No'}</div>
                `;
                showStatus(`Dana voice available: ${danaVoice.name}`, 'success');
            } else {
                statusDiv.innerHTML = `
                    <div style="color: #fbbf24;">‚ö†Ô∏è Dana voice not found</div>
                    <div>Best alternative: ${bestFemaleVoice ? bestFemaleVoice.name : 'None found'}</div>
                `;
                showStatus('Dana voice not available, using fallback', 'error');
            }
            
            // List all voices
            voiceListDiv.innerHTML = voices.map(voice => {
                const isDana = voice.name.toLowerCase().includes('dana');
                const isFemale = voice.name.toLowerCase().includes('female') || 
                                voice.name.toLowerCase().includes('woman') ||
                                ['Allison', 'Samantha', 'Victoria', 'Susan', 'Karen', 'Ava', 'Serena', 'Zoe', 'Fiona', 'Moira', 'Tessa', 'Veena'].some(name => voice.name.includes(name));
                
                return `<div ${isDana ? 'class="dana-found"' : ''}>
                    ${isDana ? 'üéØ ' : isFemale ? '‚ôÄÔ∏è ' : ''}${voice.name} (${voice.lang}) ${voice.localService ? '[Local]' : '[Remote]'}
                </div>`;
            }).join('');
        }
        
        function checkVoices() {
            showStatus('Refreshing voice list...', 'info');
            loadVoices();
        }
        
        function testDanaVoice() {
            const testMessage = "Hello! I'm Dr. Lucy, your professional copilot. This is a test of Dana's voice for the ASOOS system.";
            
            if (danaVoice) {
                showStatus(`Testing Dana voice: ${danaVoice.name}`, 'info');
                speak(testMessage, danaVoice);
            } else {
                showStatus('Dana voice not available, testing best alternative', 'error');
                if (bestFemaleVoice) {
                    speak(testMessage, bestFemaleVoice);
                } else {
                    showStatus('No suitable voice found', 'error');
                }
            }
        }
        
        function testFallbackVoice() {
            const testMessage = "This is a test of the fallback voice system for Dr. Lucy's professional copilot interface.";
            
            if (bestFemaleVoice) {
                showStatus(`Testing fallback voice: ${bestFemaleVoice.name}`, 'info');
                speak(testMessage, bestFemaleVoice);
            } else {
                showStatus('No fallback voice available', 'error');
            }
        }
        
        function speak(text, voice) {
            // Stop any current speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = voice;
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;
            
            utterance.onstart = () => {
                showStatus(`üó£Ô∏è Speaking with ${voice.name}...`, 'info');
            };
            
            utterance.onend = () => {
                showStatus(`‚úÖ Speech completed with ${voice.name}`, 'success');
            };
            
            utterance.onerror = (event) => {
                showStatus(`‚ùå Speech error: ${event.error}`, 'error');
            };
            
            console.log(`üó£Ô∏è Speaking: "${text}" with voice: ${voice.name}`);
            speechSynthesis.speak(utterance);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('Initializing voice system...', 'info');
            
            // Load voices with multiple attempts
            setTimeout(() => loadVoices(), 100);
            setTimeout(() => loadVoices(), 500);
            setTimeout(() => loadVoices(), 1000);
            
            // Listen for voice changes
            speechSynthesis.addEventListener('voiceschanged', loadVoices);
            
            // Load on user interaction
            document.addEventListener('click', loadVoices, { once: true });
        });
    </script>
</body>
</html>
