<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASOOS.2100.Cool - Owner Interface (Testament Swarm Connected)</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <!-- Enterprise-grade icon solution - Multiple fallbacks -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" crossorigin="anonymous">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      overflow-x: hidden;
      overflow-y: auto;
      min-height: 100vh;
    }

    /* Enterprise Icon System - Bulletproof SVG Icons */
    .enterprise-icon {
      width: 16px;
      height: 16px;
      display: inline-block;
      vertical-align: middle;
      fill: currentColor;
    }

    .enterprise-icon.large {
      width: 20px;
      height: 20px;
    }

    .enterprise-icon.xl {
      width: 24px;
      height: 24px;
    }

    /* Panel Icons */
    .panel-icon {
      width: 14px;
      height: 14px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    /* Integration Icons - Enterprise Grade */
    .integration-icon-svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
      display: inline-block;
    }

    /* User Role Styling */
    .location-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(11, 177, 187, 0.1);
      border: 1px solid rgba(11, 177, 187, 0.3);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #0bb1bb;
    }

    .location-indicator.diamond-sao {
      background: rgba(255, 215, 0, 0.1);
      border-color: rgba(255, 215, 0, 0.3);
      color: #FFD700;
    }

    .location-indicator.admin {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(139, 92, 246, 0.3);
      color: #8b5cf6;
    }

    /* Enhanced Animations for V99 */
    @keyframes float {
      0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); }
      33% { transform: translateY(-15px) translateX(8px) rotate(8deg); }
      66% { transform: translateY(8px) translateX(-8px) rotate(-8deg); }
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 5px rgba(11, 177, 187, 0.8), 0 0 20px rgba(11, 177, 187, 0.4); }
      50% { box-shadow: 0 0 20px rgba(11, 177, 187, 1), 0 0 40px rgba(11, 177, 187, 0.6); }
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.08); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    @keyframes scan {
      0% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-50%); opacity: 0.5; }
      100% { transform: translateY(-100%); opacity: 0; }
    }

    /* V99 Enhanced Particle Float Animation */
    @keyframes enhancedFloat {
      0%, 100% { 
        transform: translateY(0) translateX(0) rotate(0deg) scale(1); 
        filter: blur(0px); 
        opacity: 0.6; 
      }
      25% { 
        transform: translateY(-20px) translateX(10px) rotate(90deg) scale(1.2); 
        filter: blur(1px); 
        opacity: 0.8; 
      }
      50% { 
        transform: translateY(-10px) translateX(-15px) rotate(180deg) scale(0.8); 
        filter: blur(2px); 
        opacity: 0.4; 
      }
      75% { 
        transform: translateY(15px) translateX(5px) rotate(270deg) scale(1.1); 
        filter: blur(1px); 
        opacity: 0.7; 
      }
    }

    /* Main Container */
    .main-container {
      display: flex;
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      position: relative;
    }

    .page {
      display: none;
      width: 100%;
      min-height: 100vh;
    }

    .page.active {
      display: flex;
    }

    /* V99 Enhanced Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: -1;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      animation: enhancedFloat 12s infinite ease-in-out;
    }

    /* V99 Particle Variations */
    .particle:nth-child(3n) {
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, rgba(11, 177, 187, 0.8), rgba(11, 177, 187, 0.2));
      animation-duration: 15s;
    }

    .particle:nth-child(3n+1) {
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, rgba(80, 200, 120, 0.6), rgba(80, 200, 120, 0.1));
      animation-duration: 10s;
    }

    .particle:nth-child(3n+2) {
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.7), rgba(255, 215, 0, 0.2));
      animation-duration: 18s;
    }

    /* Sidebar */
    .sidebar {
      width: 48px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 20px 4px;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 100;
    }

    .sidebar-icons {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex: 1;
      width: 100%;
    }

    .sidebar-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      z-index: 101;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-icon:hover {
      transform: scale(1.15);
    }

    .sidebar-icon.active {
      animation: glow 2s infinite;
    }

    .sidebar-icon.settings-icon {
      margin-top: 30px;
    }

    .sidebar-icon.settings-icon:hover {
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.6) !important;
      background: rgba(255, 215, 0, 0.2) !important;
      border-radius: 50%;
    }

    .icon-tooltip {
      position: absolute;
      left: 54px;
      top: 50%;
      transform: translateY(-50%) translateX(-5px);
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(10px);
      padding: 8px 12px;
      border-radius: 6px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      border: 1px solid rgba(11, 177, 187, 0.5);
      font-size: 12px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .sidebar-icon:hover .icon-tooltip {
      opacity: 1;
      transform: translateY(-50%) translateX(5px);
    }

    /* Header - Compact and Centered */
    .header {
      height: 40px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      position: sticky;
      top: 0;
      z-index: 90;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      padding-left: 40px;
    }

    .header-center {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .logo {
      font-size: 20px;
      font-weight: 900;
      background: linear-gradient(135deg, #FFD700, #c7b299, #50C878, #0bb1bb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 1px;
    }

    .user-info {
      padding-right: 40px;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
    }

    .user-tagline {
      font-size: 13px;
      color: #0bb1bb;
      margin-top: 0px;
      margin-bottom: 0px;
      font-weight: 500;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
      margin-left: 48px;
      width: calc(100% - 48px);
    }

    .content-area {
      flex: 1;
      display: flex;
      padding: 6px 15px 15px 15px;
      gap: 15px;
      overflow-y: auto;
      min-height: calc(100vh - 85px);
      position: relative;
    }

    /* Sticky Copilots - Always visible on mobile */
    .sticky-copilots {
      position: sticky;
      top: 40px;
      z-index: 85;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 10px 20px;
      display: none;
    }

    /* V99 Enhanced Copilot Hexagons */
    .copilot-hex-container {
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: center;
      padding: 6px 0;
      width: 100%;
    }

    .copilot-hex-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .copilot-hex-item:hover {
      transform: scale(1.1);
      animation: pulse 1.5s infinite;
    }

    .copilot-hex-item.active .copilot-status {
      opacity: 1;
      animation: pulse 2s infinite;
    }

    .copilot-hex {
      position: relative;
    }

    .copilot-name {
      font-size: 10px;
      color: #888;
      margin-top: 4px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .copilot-name.active {
      color: #0bb1bb;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(11, 177, 187, 0.5);
    }

    .copilot-status {
      position: absolute;
      bottom: -2px;
      right: -2px;
      width: 10px;
      height: 10px;
      background: #0bb1bb;
      border-radius: 50%;
      border: 2px solid #0a0a0a;
      opacity: 0;
      transition: all 0.3s;
      box-shadow: 0 0 10px rgba(11, 177, 187, 0.8);
    }

    /* Chat Area - Co-pilot Communication */
    .chat-area {
      flex: 1;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      position: relative;
      transition: all 0.3s ease;
      height: calc(100vh - 120px);
      overflow: hidden;
    }
    
    .chat-messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    .chat-input-area {
      flex-shrink: 0;
      padding: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.1);
    }

    .terminal-output {
      scrollbar-width: thin;
      scrollbar-color: #333 #0d0d0d;
    }

    /* Right Panel - Enhanced with 100% Automation */
    .right-panel {
      width: 320px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      height: calc(100vh - 120px);
      background: transparent;
      padding: 0 12px 12px 0;
      overflow-y: auto;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      flex-shrink: 0;
      border-left: 1px solid rgba(255, 255, 255, 0.1);
    }

    .right-panel.expanded {
      width: 50%;
      min-width: 500px;
    }

    .right-panel.full-width {
      width: 70%;
      min-width: 600px;
    }

    .right-panel.collapsed {
      width: 0;
      padding: 0;
      opacity: 0;
      transform: translateX(100%);
    }

    .right-panel.hidden {
      width: 0;
      padding: 0;
      opacity: 0;
      transform: translateX(100%);
    }
    
    .chat-area.expanded {
      max-width: 100%;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .right-panel.collapsed .panel-content,
    .right-panel.collapsed .copilot-name,
    .right-panel.collapsed .panel-card {
      display: none;
    }

    .right-panel.hidden .panel-content,
    .right-panel.hidden .copilot-name,
    .right-panel.hidden .panel-card {
      display: none;
    }

    /* Panel Controls - On Panel Border */
    .panel-controls {
      position: absolute;
      left: -20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 150;
      background: rgba(0, 0, 0, 0.9);
      padding: 4px 2px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      align-items: center;
      justify-content: center;
    }

    .panel-lock {
      width: 24px;
      height: 24px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }

    .panel-lock:hover {
      background: rgba(11, 177, 187, 0.2);
      border-color: rgba(11, 177, 187, 0.5);
      transform: scale(1.1);
    }

    .panel-lock.locked svg {
      fill: #0bb1bb;
    }

    .panel-toggle-btn {
      width: 24px;
      height: 24px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }

    .panel-toggle-btn:hover {
      background: rgba(11, 177, 187, 0.2);
      border-color: rgba(11, 177, 187, 0.5);
      transform: scale(1.1);
    }

    /* Copilot Section */
    .copilot-section {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 6px;
      position: sticky;
      top: 0;
      z-index: 5;
    }

    .copilot-title {
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      color: #0bb1bb;
      margin-bottom: 6px;
    }

    .active-copilot-display {
      text-align: center;
      font-size: 9px;
      color: #888;
      padding: 4px;
      margin-top: 6px;
    }

    .copilot-badge {
      padding: 4px 8px;
      background: rgba(11, 177, 187, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(11, 177, 187, 0.2);
      display: inline-block;
    }

    .copilot-badge span {
      color: #0bb1bb;
      font-weight: 600;
    }

    .scan-approve-btn {
      margin-top: 6px;
      padding: 6px;
      background: linear-gradient(135deg, #0bb1bb, #50C878);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
    }

    .scan-approve-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(11, 177, 187, 0.5);
    }

    .scan-approve-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: white;
      font-weight: 600;
      font-size: 11px;
    }

    .panel-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px;
      transition: all 0.3s;
      margin-bottom: 6px;
    }

    .panel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(11, 177, 187, 0.2);
      border-color: rgba(11, 177, 187, 0.3);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      cursor: pointer;
      background: transparent;
      border: none;
      color: inherit;
      width: 100%;
      text-align: left;
    }

    .panel-header:hover .chevron-icon {
      fill: #0bb1bb;
    }

    .panel-header.collapsed .chevron-icon {
      transform: rotate(-90deg);
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-content {
      display: none;
    }

    .panel-content.active {
      display: block;
      animation: slideIn 0.3s ease;
    }

    /* V99 Enhanced Bottom Bar */
    .bottom-bar {
      height: 35px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 15px;
      position: relative;
      z-index: 90;
    }

    /* V99 Enhanced Integration Icons */
    .integration-icons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      flex: 1;
    }

    .integration-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 18px;
      position: relative;
      backdrop-filter: blur(10px);
    }

    .integration-icon:hover {
      transform: scale(1.15) translateY(-3px);
      background: linear-gradient(135deg, rgba(11, 177, 187, 0.3), rgba(11, 177, 187, 0.1));
      border-color: #0bb1bb;
      box-shadow: 0 5px 15px rgba(11, 177, 187, 0.4);
    }

    .integration-icon.active {
      background: linear-gradient(135deg, rgba(11, 177, 187, 0.4), rgba(11, 177, 187, 0.2));
      border-color: #0bb1bb;
      box-shadow: 0 0 20px rgba(11, 177, 187, 0.5);
    }

    /* V99 Gift Shop & Pilots' Lounge */
    .auth-features {
      position: absolute;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.5s ease;
    }

    .auth-features.visible {
      opacity: 1;
      transform: translateX(0);
    }

    .gift-shop-btn, .pilots-lounge-btn {
      padding: 4px 8px;
      background: linear-gradient(135deg, #FFD700, #FF6B35);
      border: none;
      border-radius: 12px;
      color: #000;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 9px;
      box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }

    .pilots-lounge-btn {
      background: linear-gradient(135deg, #8B5CF6, #EC4899);
    }

    .gift-shop-btn:hover, .pilots-lounge-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
    }

    .gateway-btn {
      padding: 6px 12px;
      background: #0bb1bb;
      border: none;
      border-radius: 15px;
      color: black;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      margin-left: 8px;
    }

    .gateway-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(11, 177, 187, 0.5);
    }

    /* V99 Video Integration Window */
    .video-window {
      position: fixed;
      top: 100px;
      right: 30px;
      width: 300px;
      height: 200px;
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid rgba(11, 177, 187, 0.5);
      border-radius: 15px;
      backdrop-filter: blur(20px);
      z-index: 150;
      display: none;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
    }

    .video-window.small { width: 300px; height: 200px; }
    .video-window.large { width: 500px; height: 350px; }
    .video-window.fullscreen { 
      top: 0; right: 0; left: 0; bottom: 0; 
      width: 100vw; height: 100vh; 
      border-radius: 0; 
    }

    .video-header {
      background: rgba(11, 177, 187, 0.1);
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(11, 177, 187, 0.3);
    }

    .video-title {
      color: #0bb1bb;
      font-weight: 600;
      font-size: 12px;
    }

    .video-controls {
      display: flex;
      gap: 8px;
    }

    .video-btn {
      width: 24px;
      height: 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      transition: all 0.3s;
    }

    .video-btn:hover {
      background: rgba(11, 177, 187, 0.3);
      border-color: #0bb1bb;
    }

    .video-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      font-size: 14px;
    }

    /* S2DO Button */
    .s2do-button {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 80px;
      height: 60px;
      background: linear-gradient(135deg, #0bb1bb, #50C878);
      border-radius: 15px;
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(11, 177, 187, 0.4);
      transition: all 0.3s;
      z-index: 95;
      position: relative;
    }

    .s2do-button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(11, 177, 187, 0.6);
    }

    .s2do-button.scanning::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: scan 2s linear infinite;
    }

    /* V99 Enhanced Notification */
    .notification {
      position: fixed;
      top: 60px;
      right: 20px;
      background: rgba(11, 177, 187, 0.95);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      box-shadow: 0 2px 10px rgba(11, 177, 187, 0.4);
      animation: slideIn 0.3s ease;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(11, 177, 187, 0.3);
      max-width: 300px;
      word-wrap: break-word;
    }

    .notification.error {
      background: rgba(239, 68, 68, 0.95);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .notification.success {
      background: rgba(16, 185, 129, 0.95);
      border-color: rgba(16, 185, 129, 0.3);
    }

    /* Mobile Breakpoints */
    @media (max-width: 768px) {
      .sticky-copilots {
        display: block;
      }

      .copilot-section {
        display: none;
      }

      .chat-area {
        display: none !important;
      }

      .content-area {
        flex-direction: column;
        padding: 15px;
        margin-right: 0;
      }

      .right-panel {
        position: relative;
        width: 100%;
        height: auto;
        border-left: none;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        transform: none !important;
        padding: 20px 15px;
      }

      .panel-controls {
        display: none;
      }

      .sidebar {
        width: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar-icons {
        justify-content: center;
      }

      .main-content {
        margin-left: 44px;
        width: calc(100% - 44px);
      }

      .s2do-button {
        bottom: 120px;
        right: 15px;
        width: 70px;
        height: 55px;
      }

      .auth-features {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .sidebar {
        width: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar-icons {
        justify-content: center;
      }

      .sidebar-icon {
        width: 32px;
        height: 32px;
      }

      .main-content {
        margin-left: 40px;
        width: calc(100% - 40px);
      }

      .header {
        height: 35px;
        padding: 0 10px;
      }

      .header-center .logo {
        font-size: 14px;
      }

      .user-name {
        font-size: 10px;
      }

      .user-tagline {
        font-size: 8px;
      }

      .location-indicator {
        font-size: 8px;
        padding: 3px 6px;
      }

      .s2do-button {
        bottom: 100px;
        right: 10px;
        width: 65px;
        height: 50px;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- V99 Enhanced Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Enterprise Icon Library - SVG Definitions -->
    <svg style="display: none;">
      <defs>
        <!-- Lock Icons -->
        <symbol id="icon-lock" viewBox="0 0 24 24">
          <path d="M6 10h2V8c0-2.21 1.79-4 4-4s4 1.79 4 4v2h2c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2v-8c0-1.1.9-2 2-2zm6-6c-1.1 0-2 .9-2 2v2h4V6c0-1.1-.9-2-2-2z"/>
        </symbol>
        <symbol id="icon-unlock" viewBox="0 0 24 24">
          <path d="M18 10H9V8c0-1.1.9-2 2-2s2 .9 2 2h2c0-2.21-1.79-4-4-4S7 5.79 7 8v2H6c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2z"/>
        </symbol>
        
        <!-- Menu/Bars Icon -->
        <symbol id="icon-bars" viewBox="0 0 24 24">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </symbol>
        
        <!-- Chevron Icon -->
        <symbol id="icon-chevron-down" viewBox="0 0 24 24">
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </symbol>
        
        <!-- Panel Icons -->
        <symbol id="icon-fire" viewBox="0 0 24 24">
          <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM12 20c-3.31 0-6-2.69-6-6 0-1.53.3-3.04.86-4.43.14-.35.48-.57.86-.57.53 0 .96.43.96.96 0 .44-.26.83-.66.99C6.24 11.69 6 12.83 6 14c0 2.21 1.79 4 4 4s4-1.79 4-4c0-1.17-.24-2.31-.96-3.05-.4-.16-.66-.55-.66-.99 0-.53.43-.96.96-.96.38 0 .72.22.86.57.56 1.39.86 2.9.86 4.43 0 3.31-2.69 6-6 6z"/>
        </symbol>
        
        <symbol id="icon-lightbulb" viewBox="0 0 24 24">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.87-3.13-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/>
        </symbol>
        
        <symbol id="icon-tasks" viewBox="0 0 24 24">
          <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
        </symbol>
        
        <symbol id="icon-chart-line" viewBox="0 0 24 24">
          <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
        </symbol>
        
        <symbol id="icon-bullseye" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
        </symbol>
        
        <symbol id="icon-rocket" viewBox="0 0 24 24">
          <path d="M9.19 6.35c-2.04 2.29-3.44 5.58-3.44 5.58L2 10.69l4.05-4.05c.47-.47 1.15-.68 1.81-.55l1.33.28zm5.62 0c2.04 2.29 3.44 5.58 3.44 5.58L22 10.69l-4.05-4.05c-.47-.47-1.15-.68-1.81-.55l-1.33.28zM12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
        </symbol>

        <!-- Integration Icons -->
        <symbol id="icon-google" viewBox="0 0 24 24">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </symbol>
        
        <symbol id="icon-microsoft" viewBox="0 0 24 24">
          <path d="M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zM24 11.4H12.6V0H24v11.4z"/>
        </symbol>
        
        <symbol id="icon-slack" viewBox="0 0 24 24">
          <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
        </symbol>
        
        <symbol id="icon-github" viewBox="0 0 24 24">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </symbol>
        
        <symbol id="icon-linkedin" viewBox="0 0 24 24">
          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
        </symbol>
        
        <symbol id="icon-video" viewBox="0 0 24 24">
          <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
        </symbol>
        
        <symbol id="icon-plus" viewBox="0 0 24 24">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </symbol>

        <!-- Communications Icons -->
        <symbol id="icon-comments" viewBox="0 0 24 24">
          <path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h11c.55 0 1-.45 1-1z"/>
        </symbol>
        
        <symbol id="icon-terminal" viewBox="0 0 24 24">
          <path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4V8h16v10z"/>
          <path d="M7 13h2v-2H7v2zm4 0h6v-2h-6v2z"/>
        </symbol>
        
        <symbol id="icon-microphone" viewBox="0 0 24 24">
          <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
        </symbol>
        
        <!-- CLI Related Icons -->
        <symbol id="icon-cog" viewBox="0 0 24 24">
          <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
        </symbol>
        
        <symbol id="icon-times" viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </symbol>
        
        <symbol id="icon-code" viewBox="0 0 24 24">
          <path d="M8 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H8zm1 2h6v14H9V5zm2 2v2h2V7h-2zm0 4v2h2v-2h-2z"/>
          <path d="M9.5 6.5l-3 3 3 3M14.5 6.5l3 3-3 3"/>
        </symbol>
        
        <symbol id="icon-bolt" viewBox="0 0 24 24">
          <path d="M11 21h-1l1-7H7.5c-.88 0-.33-.75-.31-.78C8.48 10.94 10.42 7.54 13.01 3h1.5l-1.01 7H17c.69 0 .52.75.48.78C16.19 13.08 14.13 16.3 11 21z"/>
        </symbol>
        
        <symbol id="icon-keyboard" viewBox="0 0 24 24">
          <path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/>
        </symbol>
        
        <!-- Additional missing icons -->
        <symbol id="icon-compress" viewBox="0 0 24 24">
          <path d="M6 18h4v-2H6v2zM6 6v2h4V6H6zm8 8h4v-2h-4v2zm4-8v2h-4V6h4z"/>
        </symbol>
        
        <symbol id="icon-expand" viewBox="0 0 24 24">
          <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
        </symbol>
        
        <symbol id="icon-expand-arrows" viewBox="0 0 24 24">
          <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
        </symbol>
      </defs>
    </svg>

    <!-- V99 Video Integration Window -->
    <div class="video-window" id="videoWindow">
      <div class="video-header">
        <div class="video-title">Daily.co Video Session</div>
        <div class="video-controls">
          <button class="video-btn" onclick="resizeVideo('small')" title="Small">
            <svg class="enterprise-icon"><use href="#icon-compress"></use></svg>
          </button>
          <button class="video-btn" onclick="resizeVideo('large')" title="Large">
            <svg class="enterprise-icon"><use href="#icon-expand"></use></svg>
          </button>
          <button class="video-btn" onclick="resizeVideo('fullscreen')" title="Fullscreen">
            <svg class="enterprise-icon"><use href="#icon-expand-arrows"></use></svg>
          </button>
          <button class="video-btn" onclick="closeVideo()" title="Close">
            <svg class="enterprise-icon"><use href="#icon-times"></use></svg>
          </button>
        </div>
      </div>
      <div class="video-content">
        <div>
          <svg class="enterprise-icon xl" style="margin-bottom: 10px;"><use href="#icon-video"></use></svg>
          <div>Video session ready to start</div>
        </div>
      </div>
    </div>

    <!-- Main Page -->
    <div id="mainPage" class="page active">
      <!-- Sidebar with Squadron Icons -->
      <div class="sidebar">
        <div class="sidebar-icons">
          <div class="sidebar-icon active" onclick="selectIcon(this, 'Communication', '01')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" fill="none" />
              <path d="M9 11l2 2 4-4" stroke="white" stroke-width="1.5" fill="none"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Communication</strong><br>
              <small>Automated Communication</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="selectIcon(this, 'Growth', '01')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#4ECDC4" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 8v4l3 3" stroke="white" stroke-width="1.5"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Growth</strong><br>
              <small>Growth Revenues</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="selectIcon(this, 'Services', '03')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#45B7D1" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" />
              <path d="M8 12h8M12 8v8" stroke="white" stroke-width="1.5"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Services</strong><br>
              <small>Client Services Innovation</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="selectIcon(this, 'Automation', '02')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#96CEB4" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" stroke="white" stroke-width="1.5"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Automation</strong><br>
              <small>Organizational Automation</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="selectIcon(this, 'ROI', '02')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#FECA57" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" />
              <circle cx="12" cy="12" r="3" stroke="white" fill="none" stroke-width="1.5"/>
            </svg>
            <div class="icon-tooltip">
              <strong>ROI</strong><br>
              <small>ROI Dashboard</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="selectIcon(this, 'Wish', '04')">
            <svg viewBox="0 0 24 24" fill="none" stroke="#DDA0DD" stroke-width="1.8">
              <circle cx="12" cy="12" r="10" />
              <path d="M7 12h10M7 8h10M7 16h10" stroke="white" stroke-width="1.5"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Wish</strong><br>
              <small>Your Wish</small>
            </div>
          </div>
          
          <div class="sidebar-icon" onclick="toggleAcademy(this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="url(#turquoiseGradient)" stroke-width="1.8">
              <defs>
                <linearGradient id="turquoiseGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#00CED1" />
                  <stop offset="33%" stop-color="#40E0D0" />
                  <stop offset="66%" stop-color="#48D1CC" />
                  <stop offset="100%" stop-color="#0891a0" />
                </linearGradient>
              </defs>
              <path d="M12 2L22 20H2L12 2z" fill="url(#turquoiseGradient)" fill-opacity="0.15" />
            </svg>
            <div class="icon-tooltip">
              <strong>Academy</strong><br>
              <small>Learning & Training</small>
            </div>
          </div>
          
          <!-- Gap before special features -->
          <div style="height: 30px;"></div>
          
          <!-- Pilots Icon - More Commercial Design -->
          <div class="sidebar-icon auth-only" onclick="openPilotsLounge()" style="display: flex;">
            <svg viewBox="0 0 24 24" fill="none" stroke="url(#pilotsGradient)" stroke-width="1.6">
              <defs>
                <linearGradient id="pilotsGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#8B5CF6" />
                  <stop offset="50%" stop-color="#EC4899" />
                  <stop offset="100%" stop-color="#F59E0B" />
                </linearGradient>
              </defs>
              <path d="M12 2l2.5 5 5.5 1-4 4 1 5.5-5-2.5-5 2.5 1-5.5-4-4 5.5-1z" fill="url(#pilotsGradient)" fill-opacity="0.2" stroke="url(#pilotsGradient)"/>
              <circle cx="12" cy="10" r="2" fill="none" stroke="white" stroke-width="1"/>
              <path d="M12 14c-2 0-3 1-3 2" stroke="white" stroke-width="1" fill="none"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Pilots' Lounge</strong><br>
              <small>Elite Features</small>
            </div>
          </div>
          
          <!-- Gift Shop Icon - More Commercial Design -->
          <div class="sidebar-icon auth-only" onclick="openGiftShop()" style="display: flex;">
            <svg viewBox="0 0 24 24" fill="none" stroke="url(#giftGradient)" stroke-width="1.6">
              <defs>
                <linearGradient id="giftGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#FFD700" />
                  <stop offset="50%" stop-color="#FF6B35" />
                  <stop offset="100%" stop-color="#FF1744" />
                </linearGradient>
              </defs>
              <path d="M12 2l2.5 5 5.5 1-4 4 1 5.5-5-2.5-5 2.5 1-5.5-4-4 5.5-1z" fill="url(#giftGradient)" fill-opacity="0.2" stroke="url(#giftGradient)"/>
              <rect x="8" y="9" width="8" height="6" fill="none" stroke="white" stroke-width="1"/>
              <path d="M12 9v6M8 12h8" stroke="white" stroke-width="1"/>
            </svg>
            <div class="icon-tooltip">
              <strong>Gift Shop</strong><br>
              <small>Premium Features</small>
            </div>
          </div>
          
          <!-- Settings Icon - Always Last -->
          <div class="sidebar-icon settings-icon" onclick="openSettings()">
            <svg viewBox="0 0 24 24" fill="none" stroke="url(#settingsGradient)" stroke-width="1.8">
              <defs>
                <linearGradient id="settingsGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#FFD700" />
                  <stop offset="25%" stop-color="#FF6B6B" />
                  <stop offset="50%" stop-color="#4ECDC4" />
                  <stop offset="75%" stop-color="#50C878" />
                  <stop offset="100%" stop-color="#0bb1bb" />
                </linearGradient>
              </defs>
              <path d="M12 2l3 7 7 1-5 5 1 7-6-3-6 3 1-7-5-5 7-1z" fill="url(#settingsGradient)" fill-opacity="0.2" />
            </svg>
            <div class="icon-tooltip">
              <strong>Settings & Configuration</strong><br>
              <small>Diamond SAO</small>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="main-content">
        <!-- Header with Location Indicator -->
        <div class="header">
          <div class="header-left">
            <div class="logo" id="systemLogo">ASOOS</div>
          </div>
          <div class="user-info">
            <div class="user-name" id="userName">Mr. Phillip Corey Roark, CEO</div>
            <div class="user-tagline" id="userTagline">Aixtiv Symphony Orchestrating Operating System</div>
          </div>
        </div>

        <!-- Sticky Copilots (Mobile Only) -->
        <div class="sticky-copilots">
          <div class="copilot-title">YOUR AI COPILOTS</div>
          <div class="copilot-hex-container">
            <div class="copilot-hex-item" onclick="activateRIX('QB', 'Dr. Lucy')">
              <div class="copilot-hex">
                <svg viewBox="0 0 60 60" style="width: 45px; height: 45px;">
                  <defs>
                    <linearGradient id="qbGradientMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#0bb1bb;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#qbGradientMobile)" stroke="#FFD700" stroke-width="2" opacity="0.9" />
                  <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">QB</text>
                  <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                </svg>
                <div class="copilot-status"></div>
              </div>
              <div class="copilot-name">Dr. Lucy</div>
            </div>
            
            <div class="copilot-hex-item" onclick="activateRIX('SH', 'Claude 4')">
              <div class="copilot-hex">
                <svg viewBox="0 0 60 60" style="width: 45px; height: 45px;">
                  <defs>
                    <linearGradient id="shGradientMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#4ECDC4;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#shGradientMobile)" stroke="#4ECDC4" stroke-width="2" opacity="0.9" />
                  <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">SH</text>
                  <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                </svg>
                <div class="copilot-status"></div>
              </div>
              <div class="copilot-name">Claude 4</div>
            </div>
            
            <div class="copilot-hex-item" onclick="activateRIX('Q', 'Q RIX')">
              <div class="copilot-hex">
                <svg viewBox="0 0 60 60" style="width: 45px; height: 45px;">
                  <defs>
                    <linearGradient id="qGradientMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#50C878;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#c7b299;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#qGradientMobile)" stroke="#50C878" stroke-width="2" opacity="0.9" />
                  <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">Q</text>
                  <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                </svg>
                <div class="copilot-status"></div>
              </div>
              <div class="copilot-name">Q RIX</div>
            </div>
          </div>
          <div class="active-copilot-display">
            <div class="copilot-badge">
              <span id="activeRixDisplayMobile">QB RIX Active</span>
            </div>
            <div class="scan-approve-btn" onclick="toggleScanToApprove(this)">
              <div class="scan-approve-content">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9V5a2 2 0 0 1 2-2h4M3 15v4a2 2 0 0 0 2 2h4M15 3h4a2 2 0 0 1 2 2v4M15 21h4a2 2 0 0 0 2-2v-4"/>
                  <path d="M9 12h6M12 9v6"/>
                </svg>
                <span>SCAN TO APPROVE</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area" id="contentArea">
          <!-- Co-pilot Communication Area (Main Body) -->
          <div class="chat-area" id="chatArea" style="background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;">
            <!-- Welcome Message at Top -->
            <div style="background: rgba(11, 177, 187, 0.1); border: 1px solid rgba(11, 177, 187, 0.3); padding: 12px; border-radius: 10px; margin: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: #0bb1bb; margin-bottom: 6px;">Welcome to Active Symphony OOS</div>
              <div style="color: #aaa; font-size: 10px; line-height: 1.4;">
                Speak naturally with your AI copilots. They understand context, can pull data from any squadron, 
                and bring visual insights directly into this space. Just ask!
              </div>
            </div>
            
            <!-- Natural Language Chat -->
            <div id="naturalLanguageChat" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
              <div class="chat-messages-container">
                <div id="copilotMessages" style="display: flex; flex-direction: column; gap: 6px;">
                  <!-- Messages appear here -->
                </div>
              </div>
              <div class="chat-input-area">
                <div style="display: flex; gap: 6px; align-items: center;">
                  <!-- Single Mode Toggle - Left Side -->
                  <button id="modeToggleBtn" onclick="toggleCopilotMode()" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.4); color: #8b5cf6; padding: 4px 8px; border-radius: 8px; font-size: 9px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 3px;" title="Switch to CLI Mode">
                    <svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #8b5cf6;">
                      <use href="#icon-terminal"></use>
                    </svg>
                    CLI
                  </button>
                  
                  <input type="text" id="copilotInput" placeholder="Ask your copilot anything..." style="flex: 1; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 12px; border-radius: 15px; color: white; font-size: 12px; outline: none;" onkeypress="handleCopilotKeyPress(event)">
                  
                  <button onclick="sendCopilotMessage()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #ffffff; padding: 8px 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 11px;">
                    Send
                  </button>
                  <button onclick="startVoiceInput()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; font-size: 10px;">
                    <svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #ffffff;">
                      <use href="#icon-microphone"></use>
                    </svg>
                  </button>
                  <button id="conversationModeBtn" onclick="toggleConversationMode()" style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.2); color: #FFD700; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; font-size: 10px;" title="Toggle voice conversation mode">
                    🗣️
                  </button>
                </div>
              </div>
            </div>
            
            <!-- AIXTIV CLI (Hidden by default) -->
            <div id="cliInterface" style="display: none; flex: 1; flex-direction: column; background: #0a0a0a; border: 1px solid #333;">
              <!-- Welcome Message at Top -->
              <div style="background: rgba(11, 177, 187, 0.1); border: 1px solid rgba(11, 177, 187, 0.3); padding: 12px; border-radius: 10px; margin: 12px;">
                <div style="font-size: 12px; font-weight: 600; color: #0bb1bb; margin-bottom: 6px;">Welcome to Active Symphony OOS</div>
                <div style="color: #aaa; font-size: 10px; line-height: 1.4;">
                  Speak naturally with your AI copilots. They understand context, can pull data from any squadron, 
                  and bring visual insights directly into this space. Just ask!
                </div>
              </div>
              <div style="background: #1a1a1a; padding: 6px 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span style="color: #0bb1bb; font-family: monospace; font-size: 11px; font-weight: 600;">AIXTIV CLI</span>
                  <span style="color: #666; font-size: 9px; font-family: monospace;">v2.1.0</span>
                  <select id="modelSelector" style="background: #2a2a2a; color: #0bb1bb; border: 1px solid #444; padding: 2px 4px; font-family: monospace; font-size: 9px; border-radius: 3px; margin-left: 6px;" onchange="switchModel(this.value)">
                    <option value="claude-code">Claude Code (Default)</option>
                    <option value="claude-3-opus">Claude 3 Opus</option>
                    <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                    <option value="claude-3-haiku">Claude 3 Haiku</option>
                    <option value="claude-instant">Claude Instant</option>
                    <option value="blend-all">🔥 Blend All Models</option>
                  </select>
                  <span id="apiStatus" style="display: flex; align-items: center; gap: 3px; margin-left: 6px;">
                    <span style="width: 6px; height: 6px; background: #ff4757; border-radius: 50%;"></span>
                    <span style="color: #ff4757; font-size: 8px;">Connecting...</span>
                  </span>
                </div>
                <div style="display: flex; gap: 4px; align-items: center;">
                  <button style="background: #2a2a2a; border: 1px solid #444; color: #0bb1bb; cursor: pointer; padding: 2px 4px; border-radius: 3px; font-size: 8px;" onclick="openAPIConfig()" title="Configure API">
                    <svg class="enterprise-icon" style="width: 8px; height: 8px;"><use href="#icon-cog"></use></svg> API Config
                  </button>
                  <button style="background: none; border: none; color: #666; cursor: pointer; padding: 2px;" onclick="clearTerminal()" title="Clear">
                    <svg class="enterprise-icon" style="width: 8px; height: 8px;"><use href="#icon-times"></use></svg>
                  </button>
                </div>
              </div>
            
            <!-- Mode Toggle -->
            <div style="background: #1a1a1a; padding: 4px 10px; border-bottom: 1px solid #333; display: flex; align-items: center; gap: 8px;">
              <button id="terminalModeBtn" class="mode-btn active" onclick="setMode('terminal')" style="background: #2a2a2a; border: 1px solid #0bb1bb; color: #0bb1bb; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 9px; cursor: pointer;">
                <svg class="enterprise-icon" style="width: 9px; height: 9px;"><use href="#icon-terminal"></use></svg> Terminal
              </button>
              <button id="codeModeBtn" class="mode-btn" onclick="setMode('code')" style="background: transparent; border: 1px solid #444; color: #666; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 9px; cursor: pointer;">
                <svg class="enterprise-icon" style="width: 9px; height: 9px;"><use href="#icon-code"></use></svg> Claude Code
              </button>
              <button id="chatModeBtn" class="mode-btn" onclick="setMode('chat')" style="background: transparent; border: 1px solid #444; color: #666; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 9px; cursor: pointer;">
                <svg class="enterprise-icon" style="width: 9px; height: 9px;"><use href="#icon-comments"></use></svg> Chat
              </button>
              <span style="color: #666; font-size: 8px; margin-left: auto;">
                <svg class="enterprise-icon" style="width: 8px; height: 8px;"><use href="#icon-keyboard"></use></svg> Ctrl+K for quick commands
              </span>
            </div>
            
            <div class="terminal-output" id="terminalOutput" style="flex: 1; overflow-y: auto; padding: 10px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 11px; line-height: 1.4; color: #e6e6e6; background: #0d0d0d; display: block;">
              <div class="terminal-line">
                <span style="color: #50C878;">asoos@aixtiv</span><span style="color: #0bb1bb;">:</span><span style="color: #4ECDC4;">~</span><span style="color: #e6e6e6;">$ </span><span style="color: #fff;">_</span>
              </div>
            </div>
            
            <!-- Code Editor (Hidden by default) -->
            <div id="codeEditor" style="display: none; flex: 1; background: #1e1e1e; position: relative;">
              <div style="background: #2d2d2d; padding: 10px; border-bottom: 1px solid #444;">
                <input type="text" id="codeFileName" placeholder="untitled.js" style="background: transparent; border: none; color: #ccc; font-family: monospace; font-size: 13px; outline: none;">
                <select id="codeLanguage" style="background: #3a3a3a; color: #0bb1bb; border: 1px solid #555; padding: 2px 6px; font-size: 12px; margin-left: 10px;">
                  <option value="javascript">JavaScript</option>
                  <option value="python">Python</option>
                  <option value="typescript">TypeScript</option>
                  <option value="html">HTML</option>
                  <option value="css">CSS</option>
                  <option value="java">Java</option>
                  <option value="cpp">C++</option>
                  <option value="go">Go</option>
                  <option value="rust">Rust</option>
                </select>
              </div>
              <textarea id="codeArea" style="width: 100%; height: calc(100% - 40px); background: #1e1e1e; color: #d4d4d4; border: none; outline: none; padding: 15px; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; line-height: 1.5; resize: none;" placeholder="// Start coding here or ask Claude to generate code..."></textarea>
            </div>
            
            <!-- Chat Interface (Hidden by default) -->
            <div id="chatInterface" style="display: none; flex: 1; overflow-y: auto; padding: 20px; background: #0d0d0d;">
              <div id="chatMessages" style="display: flex; flex-direction: column; gap: 15px;">
                <div style="background: rgba(11, 177, 187, 0.1); border: 1px solid rgba(11, 177, 187, 0.3); padding: 15px; border-radius: 12px;">
                  <div style="color: #0bb1bb; font-weight: 600; margin-bottom: 5px;">Claude Multi-Model Chat</div>
                  <div style="color: #aaa; font-size: 12px;">Chat with Claude using your selected model or blend multiple models for enhanced responses.</div>
                </div>
              </div>
            </div>
            
            <div class="cli-input-area" style="border-top: 1px solid #333; background: #1a1a1a; padding: 6px; display: flex; align-items: center; gap: 6px;">
              <span style="color: #50C878; font-family: monospace; font-size: 11px;">$</span>
              
              <!-- Single Mode Toggle - Left Side -->
              <button id="cliModeToggleBtn" onclick="toggleCopilotMode()" style="background: rgba(11, 177, 187, 0.2); border: 1px solid rgba(11, 177, 187, 0.4); color: #0bb1bb; padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 2px;" title="Switch to Chat Mode">
                <svg class="enterprise-icon" style="width: 8px; height: 8px; fill: #0bb1bb;">
                  <use href="#icon-comments"></use>
                </svg>
                CHAT
              </button>
              
              <input type="text" class="cli-input" id="cliInput" placeholder="Enter command..." style="flex: 1; background: transparent; border: none; outline: none; color: #fff; font-family: 'Monaco', 'Menlo', monospace; font-size: 11px;" onkeypress="handleCLIKeyPress(event)">
              
              <button id="executeBtn" class="cli-btn" onclick="executeCLICommand()" style="background: #0bb1bb; border: none; color: #000; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 10px; cursor: pointer; font-weight: 600;">
                EXECUTE
              </button>
              <button class="cli-btn" onclick="toggleClaudeCodeMode()" style="background: #8b5cf6; border: none; color: #fff; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 10px; cursor: pointer; font-weight: 600; margin-left: 3px;" title="Quick toggle Claude Code mode">
                <svg class="enterprise-icon" style="width: 8px; height: 8px; fill: #ffffff;"><use href="#icon-bolt"></use></svg> CODE
              </button>
            </div>
          </div>
        </div>
          
          <!-- Right Panel (Automated) -->
          <div class="right-panel" id="rightPanel">
            <!-- Always Visible Panel Controls (On Panel Border) -->
            <div class="panel-controls">
              <button class="panel-toggle-btn" onclick="toggleRightPanelSize()" title="Expand/Collapse Panel">
                <svg class="enterprise-icon" id="panelToggleIcon" fill="rgba(255, 255, 255, 0.7)" style="width: 12px; height: 12px;">
                  <use href="#icon-bars"></use>
                </svg>
              </button>
              <button class="panel-lock" id="panelLock" onclick="togglePanelLock(this)" title="Lock/Unlock Panel">
                <svg class="enterprise-icon" fill="rgba(255, 255, 255, 0.7)" style="width: 12px; height: 12px;">
                  <use href="#icon-lock"></use>
                </svg>
              </button>
            </div>
            <!-- Copilot Section (Always at Top) -->
            <div class="copilot-section">
              <div class="copilot-title">YOUR AI COPILOTS</div>
              <div class="copilot-hex-container">
                <div class="copilot-hex-item active" onclick="activateRIX('QB', 'Dr. Lucy')">
                  <div class="copilot-hex">
                    <svg viewBox="0 0 60 60" style="width: 45px; height: 45px;">
                      <defs>
                        <linearGradient id="qbGradientMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                          <stop offset="100%" style="stop-color:#0bb1bb;stop-opacity:1" />
                        </linearGradient>
                      </defs>
                      <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#qbGradientMobile)" stroke="#FFD700" stroke-width="2" opacity="0.9" />
                      <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">QB</text>
                      <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                    </svg>
                    <div class="copilot-status"></div>
                  </div>
                  <div class="copilot-name">Dr. Lucy</div>
                </div>
                
                <div class="copilot-hex-item" onclick="activateRIX('SH', 'Claude 4')" id="shRix">
                  <div class="copilot-hex">
                    <svg viewBox="0 0 60 60" style="width: 50px; height: 50px;">
                      <defs>
                        <linearGradient id="shGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" style="stop-color:#4ECDC4;stop-opacity:1" />
                          <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                        </linearGradient>
                      </defs>
                      <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#shGradient)" stroke="#4ECDC4" stroke-width="2" opacity="0.9" />
                      <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">SH</text>
                      <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                    </svg>
                    <div class="copilot-status"></div>
                  </div>
                  <div class="copilot-name">Claude 4</div>
                </div>
                
                <div class="copilot-hex-item" onclick="activateRIX('Q', 'Q RIX')" id="qRix">
                  <div class="copilot-hex">
                    <svg viewBox="0 0 60 60" style="width: 50px; height: 50px;">
                      <defs>
                        <linearGradient id="qGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" style="stop-color:#50C878;stop-opacity:1" />
                          <stop offset="100%" style="stop-color:#c7b299;stop-opacity:1" />
                        </linearGradient>
                      </defs>
                      <path d="M30 5 L50 20 L50 40 L30 55 L10 40 L10 20 Z" fill="url(#qGradient)" stroke="#50C878" stroke-width="2" opacity="0.9" />
                      <text x="30" y="26" text-anchor="middle" fill="white" font-size="12" font-weight="800">Q</text>
                      <text x="30" y="38" text-anchor="middle" fill="white" font-size="9" font-weight="600">RIX</text>
                    </svg>
                    <div class="copilot-status"></div>
                  </div>
                  <div class="copilot-name">Q RIX</div>
                </div>
              </div>
              <div class="active-copilot-display">
                <div class="copilot-badge">
                  <span id="activeRixDisplay">QB RIX Active</span>
                </div>
                <div class="scan-approve-btn" onclick="toggleScanToApprove(this)">
                  <div class="scan-approve-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 9V5a2 2 0 0 1 2-2h4M3 15v4a2 2 0 0 0 2 2h4M15 3h4a2 2 0 0 1 2 2v4M15 21h4a2 2 0 0 0 2-2v-4"/>
                      <path d="M9 12h6M12 9v6"/>
                    </svg>
                    <span>SCAN TO APPROVE</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Today's Hot Topics -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #ff6b35;">
                    <use href="#icon-fire"></use>
                  </svg>
                  Today's Hot Topics
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="hotTopicsContent">
                <div style="display: flex; align-items: center; gap: 8px; padding: 6px; border-radius: 6px; transition: all 0.3s; cursor: pointer; margin-bottom: 6px;">
                  <div style="width: 6px; height: 6px; background: linear-gradient(135deg, #ff6b35, #f7931e); border-radius: 2px; flex-shrink: 0;"></div>
                  <div style="flex: 1;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2px;">
                      <span style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; padding: 1px 4px; border-radius: 6px; font-size: 7px; font-weight: 600;">🔥 Trending</span>
                      <span style="font-size: 8px; color: #888;">2h ago</span>
                    </div>
                    <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 1px;">Vision Lake Integration Complete</div>
                    <div style="font-size: 9px; color: #aaa; line-height: 1.2;">320,000 agents operational across squadrons</div>
                  </div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; padding: 6px; border-radius: 6px; transition: all 0.3s; cursor: pointer;">
                  <div style="width: 6px; height: 6px; background: linear-gradient(135deg, #50C878, #0bb1bb); border-radius: 2px; flex-shrink: 0;"></div>
                  <div style="flex: 1;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2px;">
                      <span style="background: linear-gradient(135deg, #50C878, #0bb1bb); color: white; padding: 1px 4px; border-radius: 6px; font-size: 7px; font-weight: 600;">📈 Growth</span>
                      <span style="font-size: 8px; color: #888;">4h ago</span>
                    </div>
                    <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 1px;">Revenue Pipeline +47%</div>
                    <div style="font-size: 9px; color: #aaa; line-height: 1.2;">Q2 projections exceeding targets by ENVIRONMENT_VARIABLE_REQUIRED</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Today's Proposals -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #fbbf24;">
                    <use href="#icon-lightbulb"></use>
                  </svg>
                  Today's Proposals
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="proposalsContent">
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">Multi-Tenant Gateway Enhancement</div>
                    <span style="font-size: 8px; color: #fbbf24; background: rgba(251, 191, 36, 0.1); padding: 1px 4px; border-radius: 4px;">PENDING</span>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">Advanced tenant isolation & scaling capabilities</div>
                  <div style="font-size: 8px; color: #888;">Est. ROI: +$1.2M annually</div>
                </div>
                <div style="padding: 6px; border-radius: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">AI Copilot Expansion</div>
                    <span style="font-size: 8px; color: #50C878; background: rgba(80, 200, 120, 0.1); padding: 1px 4px; border-radius: 4px;">APPROVED</span>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">Deploy 6 additional RIX specialists</div>
                  <div style="font-size: 8px; color: #888;">Budget: $450K Q3-Q4</div>
                </div>
              </div>
            </div>

            <!-- Projects in Progress -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #10b981;">
                    <use href="#icon-tasks"></use>
                  </svg>
                  Projects in Progress
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="projectsContent">
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">V99 Interface Deployment</div>
                    <div style="font-size: 8px; color: #10b981;">87%</div>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">Production rollout to 47 enterprise clients</div>
                  <div style="width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                    <div style="width: 87%; height: 100%; background: linear-gradient(90deg, #10b981, #0bb1bb);"></div>
                  </div>
                </div>
                <div style="padding: 6px; border-radius: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">Security Audit Compliance</div>
                    <div style="font-size: 8px; color: #fbbf24;">62%</div>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">SOC2 Type II certification process</div>
                  <div style="width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                    <div style="width: 62%; height: 100%; background: linear-gradient(90deg, #fbbf24, #f59e0b);"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- How You're Growing -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #8b5cf6;">
                    <use href="#icon-chart-line"></use>
                  </svg>
                  How You're Growing
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="growthContent">
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">User Engagement</div>
                    <div style="font-size: 10px; color: #50C878; font-weight: 700;">+340%</div>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">Copilot interactions: 2.4M monthly</div>
                </div>
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">Revenue Growth</div>
                    <div style="font-size: 10px; color: #0bb1bb; font-weight: 700;">+127%</div>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">ARR: ENVIRONMENT_VARIABLE_REQUIRED (vs $8.3M last year)</div>
                </div>
                <div style="padding: 6px; border-radius: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                    <div style="font-size: 11px; font-weight: 600; color: #fff;">Client Retention</div>
                    <div style="font-size: 10px; color: #FFD700; font-weight: 700;">ENVIRONMENT_VARIABLE_REQUIRED</div>
                  </div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">Enterprise clients: 142 active</div>
                </div>
              </div>
            </div>

            <!-- How to Align with New Role -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #f59e0b;">
                    <use href="#icon-bullseye"></use>
                  </svg>
                  How to Align with New Role
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="alignmentContent">
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 2px;">Q2 Strategic Priorities</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">• Enterprise scalability (Banking sector)</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 3px;">• Multi-tenant architecture completion</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">• Regulatory compliance (SOX, GDPR)</div>
                </div>
                <div style="padding: 6px; border-radius: 6px;">
                  <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 2px;">Team Objectives</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 2px;">Leadership development: 3 promotions pending</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">Cross-training: 85% completion rate</div>
                </div>
              </div>
            </div>

            <!-- Support Your Career & Organization -->
            <div class="panel-card">
              <button class="panel-header" onclick="togglePanel(this)">
                <div class="panel-title">
                  <svg class="panel-icon" style="fill: #ec4899;">
                    <use href="#icon-rocket"></use>
                  </svg>
                  Support Your Career & Organization
                </div>
                <svg class="enterprise-icon chevron-icon" style="fill: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                  <use href="#icon-chevron-down"></use>
                </svg>
              </button>
              <div class="panel-content active" id="supportContent">
                <div style="padding: 6px; border-radius: 6px; margin-bottom: 6px;">
                  <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 2px;">Recommended Training</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 2px;">• Executive Leadership Certification (8 weeks)</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 2px;">• Enterprise Architecture Mastery</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">• Board Presentation Skills Workshop</div>
                </div>
                <div style="padding: 6px; border-radius: 6px;">
                  <div style="font-size: 11px; font-weight: 600; color: #fff; margin-bottom: 2px;">Career Advancement</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2; margin-bottom: 2px;">Next role: Chief Technology Officer</div>
                  <div style="font-size: 9px; color: #aaa; line-height: 1.2;">Target timeline: Q4 2025</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- V99 Enhanced Bottom Bar -->
        <div class="bottom-bar">
          <!-- V99 Enhanced Integration Icons -->
          <div class="integration-icons">
            <div class="integration-icon" title="Google Workspace" onclick="handleIntegrationClick('Google Workspace')">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-google"></use>
              </svg>
            </div>
            <div class="integration-icon" title="Microsoft 365" onclick="handleIntegrationClick('Microsoft 365')">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-microsoft"></use>
              </svg>
            </div>
            <div class="integration-icon" title="Slack" onclick="handleIntegrationClick('Slack')">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-slack"></use>
              </svg>
            </div>
            <div class="integration-icon" title="GitHub" onclick="handleIntegrationClick('GitHub')">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-github"></use>
              </svg>
            </div>
            <div class="integration-icon" title="LinkedIn" onclick="handleIntegrationClick('LinkedIn')">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-linkedin"></use>
              </svg>
            </div>
            <div class="integration-icon" title="Daily.co Video" onclick="openVideoSession()">
              <svg class="integration-icon-svg" style="fill: #ffffff;">
                <use href="#icon-video"></use>
              </svg>
            </div>
          </div>
          <button class="gateway-btn" onclick="openIntegrationGateway()">
            <svg class="enterprise-icon" style="fill: #000; width: 9px; height: 9px;">
              <use href="#icon-plus"></use>
            </svg>
            Integration Gateway
          </button>
        </div>
      </div>
      
      <!-- S2DO Button -->
      <button class="s2do-button" id="s2doButton" onclick="initiateScanToDo()">
        <div class="s2do-content">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9V5a2 2 0 0 1 2-2h4M3 15v4a2 2 0 0 0 2 2h4M15 3h4a2 2 0 0 1 2 2v4M15 21h4a2 2 0 0 0 2-2v-4"/>
          </svg>
          <div class="s2do-label">S2DO</div>
        </div>
        <button class="s2do-info" onclick="showS2DOInfo(event)">
          <svg class="enterprise-icon" style="width: 10px; height: 10px;"><use href="#icon-info"></use></svg>
        </button>
      </button>
    </div>
  </div>

  <!-- API Configuration Modal -->
  <div id="apiConfigModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1001;">
    <div style="background: #1a1a1a; border: 1px solid #444; border-radius: 8px; max-width: 500px; margin: 50px auto; padding: 25px;">
      <h3 style="color: #0bb1bb; margin-bottom: 20px; font-family: monospace;">Claude API Configuration</h3>
      
      <div style="margin-bottom: 15px;">
        <label style="color: #aaa; font-size: 12px; display: block; margin-bottom: 5px;">API Key</label>
        <input type="password" id="apiKey" placeholder="sk-ant-api..." style="width: 100%; background: #2a2a2a; border: 1px solid #444; color: #fff; padding: 8px; font-family: monospace; border-radius: 4px;">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="color: #aaa; font-size: 12px; display: block; margin-bottom: 5px;">Organization ID (Optional)</label>
        <input type="text" id="orgId" placeholder="org-..." style="width: 100%; background: #2a2a2a; border: 1px solid #444; color: #fff; padding: 8px; font-family: monospace; border-radius: 4px;">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="color: #aaa; font-size: 12px; display: block; margin-bottom: 5px;">Default Model</label>
        <select id="defaultModel" style="width: 100%; background: #2a2a2a; border: 1px solid #444; color: #0bb1bb; padding: 8px; font-family: monospace; border-radius: 4px;">
          <option value="claude-code">Claude Code (Recommended)</option>
          <option value="claude-3-opus">Claude 3 Opus</option>
          <option value="claude-3-sonnet">Claude 3 Sonnet</option>
          <option value="claude-3-haiku">Claude 3 Haiku</option>
        </select>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="color: #aaa; font-size: 12px; display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="enableBlending" checked>
          Enable Model Blending (Use multiple models for enhanced responses)
        </label>
      </div>
      
      <div style="border-top: 1px solid #444; padding-top: 15px; margin-top: 20px;">
        <h4 style="color: #ffa502; font-size: 14px; margin-bottom: 10px;">Enterprise Settings</h4>
        <label style="color: #aaa; font-size: 12px; display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <input type="checkbox" id="enforceCodeMode" checked>
          Default to Claude Code mode for all users
        </label>
        <label style="color: #aaa; font-size: 12px; display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="allowAPIOverride">
          Allow users to override API settings
        </label>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="saveAPIConfig()" style="background: #0bb1bb; border: none; color: #000; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 600;">
          Save Configuration
        </button>
        <button onclick="closeAPIConfig()" style="background: #444; border: none; color: #ccc; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global Variables
    let activeRIX = 'QB';
    let activeMode = 'terminal';
    let rightPanelState = 'normal'; // normal, expanded, full-width, hidden
    let isPanelLocked = false;
    let isResizing = false;
    let userRole = 'owner'; // owner, admin, diamond-sao, team-member, individual
    let userLevel = 'enterprise'; // individual, team-member, team-leader, practitioner, enterprise
    let cliMode = 'terminal'; // terminal, code, chat
    let apiConnected = false;
    let selectedModel = 'claude-code';
    let authLevel = 3; // V99 Progressive Authentication Level
    
    // Testament Swarm Integration
    let testamentSwarmConnected = false;
    let swarmData = {
      vls_solutions: [],
      revenue_metrics: {},
      active_agents: 0,
      deployment_status: 'connecting'
    };

    // V99 Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeEnhancedParticles(); // V99 Enhanced particles
      loadUserData(); // Load dynamic user information
      detectUserRole();
      loadUserPreferences();
      initializeKeyboardShortcuts();
      loadDynamicContent();
      initializeAuthFeatures(); // V99 Authentication features
      connectToTestamentSwarm(); // Initialize Testament Swarm connection
      
      // Initialize Dr. Lucy's voice system
      initializeDrLucyVoice();
      initializeVoiceRecognition();
      
      // Set initial copilot
      activateRIX('QB', 'Dr. Lucy');
      
      // Set initial mode to chat
      setCopilotMode('chat');
      
      // Auto-activate conversation mode on page load
      setTimeout(() => {
        autoActivateConversationMode();
        window.conversationAutoActivated = true;
      }, 3000);
    });
    
    // Testament Swarm Integration Functions
    function connectToTestamentSwarm() {
      showNotification('Connecting to Testament Swarm...', 'success');
      
      // Simulate connection to Testament Swarm backend
      setTimeout(() => {
        testamentSwarmConnected = true;
        swarmData = {
          vls_solutions: [
            { name: 'Dr. Lucy Flight Memory', status: 'operational', agents: 28500 },
            { name: 'Dr. Burby S2DO Blockchain', status: 'operational', agents: 32000 },
            { name: 'Professor Lee Q4D Lenz', status: 'operational', agents: 29750 },
            { name: 'Dr. Sabina Dream Commander', status: 'operational', agents: 31200 },
            { name: 'Dr. Memoria Anthology', status: 'operational', agents: 27800 },
            { name: 'Dr. Match Bid Suite', status: 'operational', agents: 30100 },
            { name: 'Dr. Grant Cybersecurity', status: 'operational', agents: 33500 },
            { name: 'Dr. Cypriot Rewards', status: 'operational', agents: 26900 },
            { name: 'Dr. Maria Support', status: 'operational', agents: 29600 },
            { name: 'Dr. Roark Wish Vision', status: 'operational', agents: 28200 },
            { name: 'Dr. Claude Orchestrator', status: 'operational', agents: 32400 }
          ],
          revenue_metrics: {
            arr: 18700000,
            growth_rate: 127,
            monthly_recurring: 1558333,
            enterprise_clients: 142
          },
          active_agents: 320000,
          deployment_status: 'fully_operational'
        };
        
        updateSwarmDataDisplay();
        showNotification('Testament Swarm Connected - All 11 VLS Solutions Operational', 'success');
      }, 2000);
    }
    
    function updateSwarmDataDisplay() {
      if (!testamentSwarmConnected) return;
      
      // Update Hot Topics with real swarm data
      const hotTopicsContent = document.getElementById('hotTopicsContent');
      if (hotTopicsContent) {
        const activeAgentsText = hotTopicsContent.querySelector('div:first-child div:last-child div:last-child');
        if (activeAgentsText) {
          activeAgentsText.textContent = `${swarmData.active_agents.toLocaleString()} agents operational across squadrons`;
        }
      }
      
      // Update Growth metrics with real data
      const growthContent = document.getElementById('growthContent');
      if (growthContent) {
        const revenueDiv = growthContent.querySelector('div:nth-child(2) div:last-child');
        if (revenueDiv) {
          revenueDiv.textContent = `ARR: $${(swarmData.revenue_metrics.arr / 1000000).toFixed(1)}M (vs $8.3M last year)`;
        }
        
        const clientDiv = growthContent.querySelector('div:last-child div:last-child');
        if (clientDiv) {
          clientDiv.textContent = `Enterprise clients: ${swarmData.revenue_metrics.enterprise_clients} active`;
        }
      }
      
      // Update copilot messages with swarm status
      addSwarmStatusMessage();
    }
    
    function addSwarmStatusMessage() {
      const messagesContainer = document.getElementById('copilotMessages');
      if (!messagesContainer) return;
      
      const swarmStatusMessage = document.createElement('div');
      swarmStatusMessage.style.cssText = `
        background: rgba(80, 200, 120, 0.1);
        border: 1px solid rgba(80, 200, 120, 0.3);
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 8px;
      `;
      
      swarmStatusMessage.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
          <div style="width: 8px; height: 8px; background: #50C878; border-radius: 50%; animation: pulse 2s infinite;"></div>
          <strong style="color: #50C878;">Testament Swarm Status</strong>
        </div>
        <div style="color: #aaa; font-size: 11px; line-height: 1.4;">
          ✅ All 11 VLS Solutions operational<br>
          📊 ${swarmData.active_agents.toLocaleString()} agents active<br>
          💰 ARR: $${(swarmData.revenue_metrics.arr / 1000000).toFixed(1)}M (+${swarmData.revenue_metrics.growth_rate}%)<br>
          🏢 ${swarmData.revenue_metrics.enterprise_clients} enterprise clients
        </div>
      `;
      
      messagesContainer.insertBefore(swarmStatusMessage, messagesContainer.firstChild);
    }
    
    function getSwarmSolutionStatus(solutionName) {
      if (!testamentSwarmConnected) return 'Connecting...';
      
      const solution = swarmData.vls_solutions.find(s => 
        s.name.toLowerCase().includes(solutionName.toLowerCase())
      );
      
      if (solution) {
        return `${solution.name}: ${solution.status} (${solution.agents.toLocaleString()} agents)`;
      }
      
      return 'Solution not found';
    }
    
    function refreshSwarmData() {
      if (!testamentSwarmConnected) {
        connectToTestamentSwarm();
        return;
      }
      
      showNotification('Refreshing Testament Swarm data...', 'success');
      
      // Simulate data refresh
      setTimeout(() => {
        // Slightly modify metrics to show live updates
        swarmData.revenue_metrics.arr += Math.floor(Math.random() * 10000);
        swarmData.active_agents += Math.floor(Math.random() * 100) - 50;
        
        updateSwarmDataDisplay();
        showNotification('Testament Swarm data refreshed', 'success');
      }, 1000);
    }

    // Load Dynamic User Data
    function loadUserData() {
      // In production, this would fetch from your authentication service
      // For now, simulating the API call
      setTimeout(() => {
        // These would come from your user management system
        const userData = {
          role: 'ASOOS Subscriber',
          userName: 'Mr. Phillip Corey Roark, CEO',
          tagline: 'Aixtiv Symphony Orchestrating Operating System',
          systemName: 'ASOOS',
          companyName: 'Aixtiv Corporation',
          authLevel: 5 // Enterprise level
        };
        
        // Update the interface with dynamic data - with null checks
        const userNameEl = document.getElementById('userName');
        const userTaglineEl = document.getElementById('userTagline');
        const systemLogoEl = document.getElementById('systemLogo');
        
        if (userNameEl) userNameEl.textContent = userData.userName;
        if (userTaglineEl) userTaglineEl.textContent = userData.tagline;
        if (systemLogoEl) systemLogoEl.textContent = userData.systemName;
        
        // Update auth level for progressive features
        authLevel = userData.authLevel;
        
        // Show smaller welcome notification
        showNotification(`Welcome back!`, 'success');
      }, 500);
    }

    // Multi-Tenant Integration Gateway
    function openMultiTenantGateway() {
      // This would connect to your actual multi-tenant integration gateway
      const gatewayUrl = 'https://gateway.asoos.com/integrations'; // Your actual gateway URL
      
      showNotification('Connecting to Multi-Tenant Integration Gateway...', 'success');
      
      // In production, this would open your integration management system
      // For demo, showing the connection process
      setTimeout(() => {
        showNotification('Multi-Tenant Gateway Connected - Managing integrations across all tenants', 'success');
        // window.open(gatewayUrl, '_blank'); // Uncomment when you have the actual URL
      }, 1000);
    }
    
    function initializeEnhancedParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 40; // Increased count for V99
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 12 + 's';
        particle.style.animationDuration = (10 + Math.random() * 8) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    // V99 Progressive Authentication
    function initializeAuthFeatures() {
      const authFeatures = document.getElementById('authFeatures');
      const sidebarAuthIcons = document.querySelectorAll('.sidebar-icon.auth-only');
      
      // Show Gift Shop & Pilots' Lounge for Level 3+ users
      if (authLevel >= 3) {
        setTimeout(() => {
          if (authFeatures) authFeatures.classList.add('visible');
          // Also show sidebar auth icons
          sidebarAuthIcons.forEach(icon => {
            icon.style.display = 'flex';
          });
        }, 1000);
      }
    }

    // V99 Gift Shop Function
    function openGiftShop() {
      if (authLevel >= 3) {
        showNotification('Opening Gift Shop - Premium Features Available', 'success');
        openVideoSession(); // Demo integration
      } else {
        showNotification('Gift Shop requires Level 3+ authentication', 'error');
      }
    }

    // V99 Pilots' Lounge Function
    function openPilotsLounge() {
      if (authLevel >= 3) {
        showNotification('Welcome to Pilots\' Lounge - Elite Features Unlocked', 'success');
        openVideoSession(); // Demo integration
      } else {
        showNotification('Pilots\' Lounge requires Level 3+ authentication', 'error');
      }
    }

    // V99 Video Integration Functions
    function openVideoSession() {
      const videoWindow = document.getElementById('videoWindow');
      if (videoWindow) {
        videoWindow.style.display = 'flex';
        videoWindow.classList.remove('large', 'fullscreen');
        videoWindow.classList.add('small');
        showNotification('Video session initiated - Academy training available', 'success');
      }
    }

    function resizeVideo(size) {
      const videoWindow = document.getElementById('videoWindow');
      if (videoWindow) {
        videoWindow.classList.remove('small', 'large', 'fullscreen');
        videoWindow.classList.add(size);
      }
    }

    function closeVideo() {
      const videoWindow = document.getElementById('videoWindow');
      if (videoWindow) {
        videoWindow.style.display = 'none';
        showNotification('Video session ended', 'success');
      }
    }

    // Detect User Role
    function detectUserRole() {
      // In production, this would come from authentication
      const urlParams = new URLSearchParams(window.location.search);
      const role = urlParams.get('role') || 'owner';
      const level = urlParams.get('level') || 'enterprise';
      
      userRole = role;
      userLevel = level;
      
      updateLocationIndicator();
      updateInterfaceForRole();
    }

    // Update Location Indicator
    function updateLocationIndicator() {
      const indicator = document.getElementById('locationIndicator');
      const roleText = document.getElementById('userRole');
      
      if (!indicator || !roleText) return;
      
      const roleMap = {
        'owner': 'Owner',
        'admin': 'ASOOS Admin',
        'diamond-sao': 'Diamond SAO',
        'team-member': 'Team Member',
        'individual': 'Individual Professional'
      };
      
      roleText.textContent = roleMap[userRole] || 'User';
      
      // Update styling based on role
      indicator.className = 'location-indicator';
      if (userRole === 'diamond-sao') {
        indicator.classList.add('diamond-sao');
      } else if (userRole === 'admin') {
        indicator.classList.add('admin');
      }
    }

    // Update Interface for Role
    function updateInterfaceForRole() {
      // Show/hide features based on role
      const techFeatures = document.querySelectorAll('.tech-only');
      const adminFeatures = document.querySelectorAll('.admin-only');
      
      if (userRole === 'diamond-sao' || userRole === 'admin') {
        // Show all features
        techFeatures.forEach(el => el.style.display = 'block');
        adminFeatures.forEach(el => el.style.display = 'block');
      } else {
        // Hide technical features for regular users
        techFeatures.forEach(el => el.style.display = 'none');
        adminFeatures.forEach(el => el.style.display = 'none');
      }
      
      // Update integration icons based on level
      updateIntegrationIcons();
    }

    // Update Integration Icons
    function updateIntegrationIcons() {
      // V99 enhanced integration handling - icons are now in HTML
      // This function can be used for dynamic integration management
      console.log('Integration icons updated for user level:', userLevel);
    }

    // Handle Integration Click - Connect to Multi-Tenant Gateway
    function handleIntegrationClick(integration) {
      showNotification(`Connecting ${integration} via Multi-Tenant Gateway...`, 'success');
      
      // In production, this would make API calls to your multi-tenant gateway
      // to manage the specific integration for this tenant
      setTimeout(() => {
        showNotification(`${integration} integration activated for your tenant`, 'success');
        // Actual integration logic would go here
        connectToIntegration(integration);
      }, 800);
    }

    // Connect to Specific Integration via Gateway
    function connectToIntegration(integrationName) {
      // This would connect to your actual integration endpoints
      const integrationEndpoint = `https://gateway.asoos.com/integrations/${integrationName.toLowerCase().replace(' ', '-')}`;
      
      // In production, this would make actual API calls to manage the integration
      console.log(`Connecting to ${integrationName} via multi-tenant gateway at ${integrationEndpoint}`);
      
      // For demo purposes, simulating successful connection
      // In production: window.open(integrationEndpoint, '_blank') or make API calls
    }

    // Toggle Copilot Mode (New Simplified Function)
    function toggleCopilotMode() {
      const naturalChat = document.getElementById('naturalLanguageChat');
      const cliInterface = document.getElementById('cliInterface');
      
      if (naturalChat && naturalChat.style.display !== 'none') {
        // Currently in chat mode, switch to CLI
        setCopilotMode('cli');
      } else {
        // Currently in CLI mode, switch to chat
        setCopilotMode('chat');
      }
    }

    // Toggle Right Panel Size (Normal -> Expanded -> Full -> Hidden -> Normal)
    function toggleRightPanelSize() {
      const rightPanel = document.getElementById('rightPanel');
      const chatArea = document.getElementById('chatArea');
      
      if (!rightPanel || isPanelLocked) return;
      
      // Cycle through states: normal -> expanded -> full-width -> hidden -> normal
      if (rightPanel.classList.contains('full-width')) {
        // Full-width -> Hidden
        rightPanel.classList.remove('full-width');
        rightPanel.classList.add('hidden');
        rightPanelState = 'hidden';
        if (chatArea) chatArea.classList.add('expanded');
      } else if (rightPanel.classList.contains('expanded')) {
        // Expanded -> Full-width
        rightPanel.classList.remove('expanded');
        rightPanel.classList.add('full-width');
        rightPanelState = 'full-width';
      } else if (rightPanel.classList.contains('hidden')) {
        // Hidden -> Normal
        rightPanel.classList.remove('hidden');
        rightPanelState = 'normal';
        if (chatArea) chatArea.classList.remove('expanded');
      } else {
        // Normal -> Expanded
        rightPanel.classList.add('expanded');
        rightPanelState = 'expanded';
      }
    }

    // Toggle Panel Lock
    function togglePanelLock(button) {
      isPanelLocked = !isPanelLocked;
      const lockIcon = button.querySelector('svg use');
      
      if (isPanelLocked) {
        button.classList.add('locked');
        if (lockIcon) lockIcon.setAttribute('href', '#icon-lock');
      } else {
        button.classList.remove('locked');
        if (lockIcon) lockIcon.setAttribute('href', '#icon-unlock');
      }
    }

    // TTS Health Check System
    let ttsHealthStatus = {
      cloudflare: true, // Primary
      elevenlabs: true, // Fallback
      browser: true     // Final fallback
    };

    async function checkTTSHealth() {
      try {
        // Check Cloudflare voice synthesis health
        const cloudflareResponse = await fetch('https://voice.asoos2100.cool/health', {
          method: 'GET',
          timeout: 3000
        });
        ttsHealthStatus.cloudflare = cloudflareResponse.ok;
      } catch (error) {
        console.log('Cloudflare TTS health check failed:', error);
        ttsHealthStatus.cloudflare = false;
      }

      try {
        // Check ElevenLabs API health (simple connectivity test)
        const elevenLabsResponse = await fetch('https://api.elevenlabs.io/v1/user', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${await getSecretValue('elevenlabs-api-key')}`,
            'Content-Type': 'application/json'
          },
          timeout: 3000
        });
        ttsHealthStatus.elevenlabs = elevenLabsResponse.ok;
      } catch (error) {
        console.log('ElevenLabs TTS health check failed:', error);
        ttsHealthStatus.elevenlabs = false;
      }

      // Browser synthesis is always available
      ttsHealthStatus.browser = 'speechSynthesis' in window;
      
      console.log('TTS Health Status:', ttsHealthStatus);
      return ttsHealthStatus;
    }

    // UI Interaction Lock System
    let uiLocked = false;
    let currentPCPQuery = null;

    function lockUI(reason = 'PCP Processing') {
      uiLocked = true;
      document.body.style.pointerEvents = 'none';
      document.body.style.opacity = '0.7';
      
      // Show processing indicator
      const lockIndicator = document.createElement('div');
      lockIndicator.id = 'ui-lock-indicator';
      lockIndicator.innerHTML = `
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                   background: rgba(0,100,200,0.9); color: white; padding: 20px; 
                   border-radius: 10px; z-index: 10000; text-align: center;">
          <div class="pulse-animation" style="font-size: 16px; margin-bottom: 10px;">${reason}</div>
          <div style="font-size: 14px; opacity: 0.8;">Please wait for response...</div>
        </div>
      `;
      document.body.appendChild(lockIndicator);
    }

    function unlockUI() {
      uiLocked = false;
      currentPCPQuery = null;
      document.body.style.pointerEvents = 'auto';
      document.body.style.opacity = '1';
      
      const lockIndicator = document.getElementById('ui-lock-indicator');
      if (lockIndicator) {
        lockIndicator.remove();
      }
    }

    // Check TTS health every 30 seconds
    setInterval(checkTTSHealth, 30000);
    checkTTSHealth(); // Initial check

    // Set Copilot Mode
    function setCopilotMode(mode) {
      const naturalChat = document.getElementById('naturalLanguageChat');
      const cliInterface = document.getElementById('cliInterface');
      const modeToggleBtn = document.getElementById('modeToggleBtn');
      const cliModeToggleBtn = document.getElementById('cliModeToggleBtn');
      
      if (mode === 'chat') {
        // Natural language mode - no layout shift
        if (naturalChat) naturalChat.style.display = 'flex';
        if (cliInterface) cliInterface.style.display = 'none';
        
        // Update toggle button to show CLI option
        if (modeToggleBtn) {
          modeToggleBtn.innerHTML = `
            <svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #8b5cf6;">
              <use href="#icon-terminal"></use>
            </svg>
            CLI
          `;
          modeToggleBtn.style.background = 'rgba(139, 92, 246, 0.2)';
          modeToggleBtn.style.borderColor = 'rgba(139, 92, 246, 0.4)';
          modeToggleBtn.style.color = '#8b5cf6';
          modeToggleBtn.title = 'Switch to CLI Mode';
        }
        
      } else {
        // CLI mode - no layout shift
        if (cliInterface) cliInterface.style.display = 'flex';
        if (naturalChat) naturalChat.style.display = 'none';
        
        // Update toggle button in CLI to show Chat option
        if (cliModeToggleBtn) {
          cliModeToggleBtn.innerHTML = `
            <svg class="enterprise-icon" style="width: 8px; height: 8px; fill: #0bb1bb;">
              <use href="#icon-comments"></use>
            </svg>
            CHAT
          `;
          cliModeToggleBtn.style.background = 'rgba(11, 177, 187, 0.2)';
          cliModeToggleBtn.style.borderColor = 'rgba(11, 177, 187, 0.4)';
          cliModeToggleBtn.style.color = '#0bb1bb';
          cliModeToggleBtn.title = 'Switch to Chat Mode';
        }
      }
    }

    // Handle Copilot Communication with Testament Swarm Integration
    function sendCopilotMessage() {
      const input = document.getElementById('copilotInput');
      const messagesContainer = document.getElementById('copilotMessages');
      
      if (!input || !messagesContainer || !input.value.trim()) return;
      
      const userMessage = input.value.trim();
      input.value = '';
      
      // Add user message
      addMessage(messagesContainer, userMessage, 'user');
      
      // Process message with Testament Swarm context
      setTimeout(() => {
        const response = processSwarmQuery(userMessage);
        addMessage(messagesContainer, response, 'copilot');
      }, 500);
    }
    
    function handleCopilotKeyPress(event) {
      if (event.key === 'Enter') {
        sendCopilotMessage();
      }
    }
    
    function addMessage(container, text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.style.cssText = `
        padding: 8px 10px;
        border-radius: 8px;
        margin-bottom: 6px;
        ${sender === 'user' 
          ? 'background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); text-align: right;'
          : 'background: rgba(11, 177, 187, 0.1); border: 1px solid rgba(11, 177, 187, 0.3);'
        }
      `;
      
      if (sender === 'copilot') {
        messageDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
            <div style="width: 6px; height: 6px; background: #0bb1bb; border-radius: 50%;"></div>
            <strong style="color: #0bb1bb; font-size: 10px;">${activeRIX} RIX</strong>
          </div>
          <div style="color: #fff; font-size: 11px; line-height: 1.3;">${text}</div>
        `;
        
        // Automatically speak Dr. Lucy's response
        setTimeout(() => {
          speakMessage(text);
        }, 300);
        
      } else {
        messageDiv.innerHTML = `
          <div style="color: #fff; font-size: 11px; line-height: 1.3;">${text}</div>
        `;
      }
      
      container.appendChild(messageDiv);
      
      // Ensure proper scrolling - scroll the messages container, not the container itself
      const messagesContainer = container.closest('.chat-messages-container');
      if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      } else {
        container.scrollTop = container.scrollHeight;
      }
    }
    
    // Connect to Intelligence Swarm (Testament Swarm) Dr. Lucy
    async function processSwarmQuery(query) {
      try {
        console.log('🌪️ Connecting to Intelligence Swarm Dr. Lucy...', query);
        
        // Call Testament Swarm Intelligence endpoint where Dr. Lucy resides
        const response = await fetch('https://testament-swarm-18m-live/dr-lucy/predict', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer testament-swarm-access-token',
            'X-RIX-Type': activeRIX || 'QB',
            'X-User-Session': Date.now().toString()
          },
          body: JSON.stringify({
            query: query,
            context: {
              user_rix: activeRIX,
              conversation_id: `mocoa_${Date.now()}`,
              timestamp: new Date().toISOString(),
              interface: 'MOCOA',
              voice_enabled: true
            },
            request_type: 'intelligence_query',
            swarm_coordination: true
          })
        });
        
        if (!response.ok) {
          console.warn('Intelligence Swarm response not ok:', response.status);
          // Fallback to local Testament Swarm data if available
          return processSwarmQueryFallback(query);
        }
        
        const result = await response.json();
        console.log('✅ Intelligence Swarm Dr. Lucy response received');
        
        // Return Dr. Lucy's intelligent response from the swarm
        return result.response || result.prediction || result.message || 'Dr. Lucy is processing your request...';
        
      } catch (error) {
        console.error('❌ Intelligence Swarm connection error:', error);
        // Graceful fallback to local Testament Swarm processing
        return processSwarmQueryFallback(query);
      }
    }
    
    // Fallback function for when Intelligence Swarm is unavailable
    function processSwarmQueryFallback(query) {
      const lowerQuery = query.toLowerCase();
      
      // Testament Swarm specific queries with Intelligence Swarm context
      if (lowerQuery.includes('status') || lowerQuery.includes('swarm')) {
        if (!testamentSwarmConnected) {
          return 'Connecting to Intelligence Swarm (Testament Swarm 18M agents). Dr. Lucy will be available momentarily...';
        }
        return `Intelligence Swarm Status: Testament Swarm operational with ${swarmData.active_agents.toLocaleString()} active agents including Dr. Lucy ML/Deep Mind. Victory36 protection active.`;
      }
      
      if (lowerQuery.includes('dr.') || lowerQuery.includes('doctor') || lowerQuery.includes('lucy')) {
        return `Dr. Lucy is part of our Intelligence Swarm (Testament Swarm) with advanced ML and Deep Mind capabilities. Connection temporarily using fallback mode. Please try your question again.`;
      }
      
      // General Intelligence Swarm responses
      const intelligenceResponses = [
        `I'm Dr. Lucy from the Intelligence Swarm. I'm temporarily using fallback processing while reconnecting to the Testament Swarm's 18M agents. How can I help you?`,
        `Intelligence Swarm (Testament Swarm) is connecting. As Dr. Lucy, I have access to ML and Deep Mind capabilities once fully connected.`,
        `Dr. Lucy here. I'm part of the Intelligence Swarm with predictive analytics and flight memory. Connection to full swarm capabilities in progress.`,
        `Intelligence Swarm connectivity: Dr. Lucy available in limited mode. Full ML/Deep Mind integration pending Testament Swarm connection.`
      ];
      
      return intelligenceResponses[Math.floor(Math.random() * intelligenceResponses.length)];
    }
    
    // Integration Gateway Function
    function openIntegrationGateway() {
      showNotification('Opening Integration Gateway Dashboard...', 'success');
      
      // In production, this would open the actual Integration Gateway interface
      setTimeout(() => {
        showNotification('Integration Gateway: Managing 23 active domains with Testament Swarm connectivity', 'success');
      }, 1000);
    }
    
    // Settings and Authentication Functions
    function openSettings() {
      // Show inline settings panel instead of redirecting
      showNotification('Opening Diamond SAO Settings...', 'success');
      
      // Create settings overlay on the same page
      createSettingsOverlay();
    }
    
    function authenticateWithSallyPort() {
      // Streamlined single-step authentication
      showNotification('Authenticating...', 'success');
      
      // Quick authentication without multiple steps
      setTimeout(() => {
        authLevel = 5; // Set enterprise auth level immediately
        initializeAuthFeatures();
        showNotification('Welcome to ASOOS! All features unlocked.', 'success');
        
        // Update UI to show authenticated state
        updateAuthenticatedState();
      }, 800);
    }
    
    function createSettingsOverlay() {
      // Create inline settings instead of navigation
      const overlay = document.createElement('div');
      overlay.id = 'settingsOverlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
      `;
      
      overlay.innerHTML = `
        <div style="background: #1a1a1a; border: 2px solid #FFD700; border-radius: 15px; padding: 30px; max-width: 500px; color: white;">
          <h2 style="color: #FFD700; margin-bottom: 20px; text-align: center;">Diamond SAO Settings</h2>
          <div style="margin-bottom: 15px;">
            <label style="color: #0bb1bb; font-weight: 600;">Authentication Level: </label>
            <span style="color: #50C878;">Enterprise (Level 5)</span>
          </div>
          <div style="margin-bottom: 15px;">
            <label style="color: #0bb1bb; font-weight: 600;">Active Services: </label>
            <span style="color: #50C878;">Testament Swarm, SallyPort, Integration Gateway</span>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="color: #0bb1bb; font-weight: 600;">Features Unlocked: </label>
            <span style="color: #50C878;">CLI, Video Sessions, Gift Shop, Pilots' Lounge</span>
          </div>
          <div style="text-align: center;">
            <button onclick="closeSettingsOverlay()" style="background: #0bb1bb; border: none; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">Close</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
    }
    
    function closeSettingsOverlay() {
      const overlay = document.getElementById('settingsOverlay');
      if (overlay) {
        overlay.remove();
      }
    }
    
    function updateAuthenticatedState() {
      // Update UI elements to show authenticated state
      const authFeatures = document.querySelectorAll('.auth-only');
      authFeatures.forEach(feature => {
        feature.style.display = 'flex';
        feature.style.opacity = '1';
      });
      
      // Show premium features immediately
      setTimeout(() => {
        showNotification('Premium features activated!', 'success');
      }, 1000);
    }
    
    // Theme switching functions
    function switchToLightTheme() {
      window.location.href = '/light';
    }
    
    function switchToDarkTheme() {
      window.location.href = '/';
    }
    
    function openDiamondSAO() {
      window.location.href = '/diamond-sao';
    }
    
    // Video Session Functions
    function openVideoSession() {
      const videoWindow = document.getElementById('videoWindow');
      videoWindow.style.display = 'block';
      showNotification('Daily.co video session starting...', 'success');
    }
    
    function closeVideo() {
      const videoWindow = document.getElementById('videoWindow');
      videoWindow.style.display = 'none';
    }
    
    function resizeVideo(size) {
      const videoWindow = document.getElementById('videoWindow');
      videoWindow.className = `video-window ${size}`;
    }
    
    // Toggle Academy
    function toggleAcademy(element) {
      showNotification('Academy interface coming soon...', 'success');
    }
    
    // Handle Integration Clicks
    function handleIntegrationClick(integration) {
      showNotification(`Connecting to ${integration}...`, 'success');
      
      setTimeout(() => {
        showNotification(`${integration} integration active`, 'success');
      }, 1000);
    }
    
    // S2DO Functions
    function initiateScanToDo() {
      const button = document.getElementById('s2doButton');
      button.classList.add('scanning');
      
      showNotification('S2DO: Scanning for approval workflows...', 'success');
      
      setTimeout(() => {
        button.classList.remove('scanning');
        showNotification('S2DO: 3 items found for approval', 'success');
      }, 3000);
    }
    
    function showS2DOInfo(event) {
      event.stopPropagation();
      showNotification('S2DO: Scan To Do - Automated approval workflow system', 'success');
    }
    
    // CLI Functions
    function openAPIConfig() {
      document.getElementById('apiConfigModal').style.display = 'block';
    }
    
    function closeAPIConfig() {
      document.getElementById('apiConfigModal').style.display = 'none';
    }
    
    function saveAPIConfig() {
      const apiKey = document.getElementById('apiKey').value;
      if (apiKey) {
        showNotification('API configuration saved successfully', 'success');
        apiConnected = true;
        updateAPIStatus();
        closeAPIConfig();
      } else {
        showNotification('Please enter a valid API key', 'error');
      }
    }
    
    function updateAPIStatus() {
      const statusEl = document.getElementById('apiStatus');
      if (apiConnected) {
        statusEl.innerHTML = `
          <span style="width: 6px; height: 6px; background: #10b981; border-radius: 50%;"></span>
          <span style="color: #10b981; font-size: 8px;">API Connected</span>
        `;
      }
    }
    
    function clearTerminal() {
      const output = document.getElementById('terminalOutput');
      output.innerHTML = `
        <div class="terminal-line">
          <span style="color: #228B22;">asoos@aixtiv</span><span style="color: #0bb1bb;">:</span><span style="color: #4ECDC4;">~</span><span style="color: #333;">$ </span><span style="color: #000;">_</span>
        </div>
      `;
    }
    
    function switchModel(model) {
      selectedModel = model;
      showNotification(`Switched to ${model}`, 'success');
    }
    
    function setMode(mode) {
      cliMode = mode;
      
      // Update button states
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = 'transparent';
        btn.style.borderColor = '#ccc';
        btn.style.color = '#999';
      });
      
      const activeBtn = document.getElementById(`${mode}ModeBtn`);
      if (activeBtn) {
        activeBtn.classList.add('active');
        activeBtn.style.background = '#fff';
        activeBtn.style.borderColor = '#0bb1bb';
        activeBtn.style.color = '#0bb1bb';
      }
      
      // Show/hide appropriate interfaces
      document.getElementById('terminalOutput').style.display = mode === 'terminal' ? 'block' : 'none';
      document.getElementById('codeEditor').style.display = mode === 'code' ? 'flex' : 'none';
      document.getElementById('chatInterface').style.display = mode === 'chat' ? 'flex' : 'none';
    }
    
    function executeCLICommand() {
      const input = document.getElementById('cliInput');
      const command = input.value.trim();
      if (command) {
        addTerminalLine(command, true);
        processCommand(command);
        input.value = '';
      }
    }
    
    function handleCLIKeyPress(event) {
      if (event.key === 'Enter') {
        executeCLICommand();
      }
    }
    
    function addTerminalLine(text, isCommand = false) {
      const output = document.getElementById('terminalOutput');
      const line = document.createElement('div');
      line.className = 'terminal-line';
      
      if (isCommand) {
        line.innerHTML = `
          <span style="color: #228B22;">asoos@aixtiv</span><span style="color: #0bb1bb;">:</span><span style="color: #4ECDC4;">~</span><span style="color: #333;">$ </span><span style="color: #000;">${text}</span>
        `;
      } else {
        line.innerHTML = `<span style="color: #666;">${text}</span>`;
      }
      
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }
    
    function processCommand(command) {
      setTimeout(() => {
        const lowerCommand = command.toLowerCase();
        
        if (lowerCommand.includes('help')) {
          addTerminalLine('Available commands: status, agents, revenue, vls, help, clear');
        } else if (lowerCommand.includes('clear')) {
          clearTerminal();
          return;
        } else if (lowerCommand.includes('status')) {
          addTerminalLine('ASOOS Status: All systems operational. Testament Swarm connected.');
        } else {
          const response = processSwarmQuery(command);
          addTerminalLine(response);
        }
        
        // Add new prompt
        const output = document.getElementById('terminalOutput');
        const prompt = document.createElement('div');
        prompt.className = 'terminal-line';
        prompt.innerHTML = `
          <span style="color: #228B22;">asoos@aixtiv</span><span style="color: #0bb1bb;">:</span><span style="color: #4ECDC4;">~</span><span style="color: #333;">$ </span><span style="color: #000;">_</span>
        `;
        output.appendChild(prompt);
        output.scrollTop = output.scrollHeight;
      }, 500);
    }
    
    function toggleClaudeCodeMode() {
      setMode('code');
      showNotification('Claude Code mode activated', 'success');
    }
    
    // PCP selectIcon Function - Activate QB (Dr. Lucy sRIX)
    function selectIcon(element, category, id) {
      console.log("🤖 Activating QB PCP for " + category);
      
      // Remove active class from all icons
      document.querySelectorAll(".sidebar-icon").forEach(icon => {
        icon.classList.remove("active");
      });
      
      // Add active class to selected icon
      element.classList.add("active");
      
      // Show QB PCP activation
      showNotification("QB PCP (Dr. Lucy sRIX) activated for " + category, "success");
      
      // Display PCP interface
      displayQBInterface(category, id);
    }
    
    function displayQBInterface(category, id) {
      // Create or update PCP display area
      let pcpDisplay = document.getElementById("pcp-display");
      if (!pcpDisplay) {
        pcpDisplay = document.createElement("div");
        pcpDisplay.id = "pcp-display";
        pcpDisplay.style.cssText = "position:fixed;top:10px;right:10px;width:320px;background:rgba(0,0,0,0.95);color:white;padding:20px;border-radius:15px;z-index:9999;border:2px solid #FFD700;box-shadow:0 10px 30px rgba(0,0,0,0.5);";
        document.body.appendChild(pcpDisplay);
      }
      
      pcpDisplay.innerHTML = `
        <h3 style="color:#FFD700;margin:0 0 15px 0;">🤖 QB PCP Active</h3>
        <p><strong>Dr. Lucy sRIX</strong></p>
        <p>Voice: OpenAI Dana</p>
        <p>Category: ${category}</p>
        <hr style="border-color:#FFD700;margin:15px 0;">
        <h4 style="color:#0bb1bb;">📋 Today's S2DO:</h4>
        <div style="font-size:12px;line-height:1.4;">
          <p>1. ✅ Complete KPI review</p>
          <p>2. ✅ Schedule 1-on-1 meetings</p>
          <p>3. ⏳ Optimize workflow process</p>
          <p>4. ⏳ Analyze customer feedback</p>
          <p>5. ⏳ Update training materials</p>
        </div>
        <hr style="border-color:#FFD700;margin:15px 0;">
        <h4 style="color:#50C878;">🔥 Hot Tips:</h4>
        <div style="font-size:12px;line-height:1.4;">
          <p>• Focus on automation (+30% efficiency)</p>
          <p>• Daily standups improve communication 15%</p>
          <p>• Response time < 2hrs boosts satisfaction</p>
        </div>
        <hr style="border-color:#FFD700;margin:15px 0;">
        <h4 style="color:#FFD700;">📊 Performance Score</h4>
        <div style="display:flex;align-items:center;gap:15px;">
          <div style="font-size:24px;font-weight:bold;color:#50C878;">87</div>
          <div style="font-size:12px;">
            <div>Rank: Top 15%</div>
            <div>Trend: ↗ Improving</div>
            <div>KPIs: 4/5 targets met</div>
          </div>
        </div>
        <button onclick="closePCPDisplay()" style="background:#FFD700;border:none;padding:8px 15px;border-radius:8px;color:black;cursor:pointer;margin-top:15px;font-weight:bold;width:100%;">Close PCP</button>
      `;
    }
    
    function closePCPDisplay() {
      const pcpDisplay = document.getElementById("pcp-display");
      if (pcpDisplay) {
        pcpDisplay.remove();
      }
    }
    
    // Ensure functions are globally available
    window.selectIcon = selectIcon;
    window.closePCPDisplay = closePCPDisplay;
    
    console.log("🤖 PCP System Ready - QB (Dr. Lucy sRIX) available for activation");
    
    // Disabled notifications - silent operation
    function showNotification(message, type = 'success') {
      // Notifications disabled - silent operation for better UX
      console.log(`[${type.toUpperCase()}] ${message}`);
      return; // No visual notifications
    }
    
    // REAL GCP Service Account Configurations - Professional Copilots
    const drLucyServiceAccount = {
      account: 'dr.lucy@asoos.com',
      service_account_email: 'drlucyautomationENVIRONMENT_VARIABLE_REQUIRED',
      gcp_project: 'api-for-warp-drive',
      display_name: 'Dr. Lucy Automation',
      project_number: '859242575175',
      service_token: 'use_gcp_application_default_credentials',
      openai_api_key: 'projects/api-for-warp-drive/secrets/openai-api-key/versions/latest',
      voice_model: 'tts-1-hd',
      voice_name: 'dana',
      provider: 'openai',
      full_authentication: true,
      qb_rix_enabled: true,
      code_execution_enabled: true,
      interface_modification_enabled: true,
      gcp_secret_manager: 'projects/api-for-warp-drive/secrets/dr-lucy-credentials/versions/latest',
      authenticated_via_gcloud: true
    };
    
    const victory36ServiceAccount = {
      account: 'victory36.ag',
      service_account_email: 'victory36-mocoaENVIRONMENT_VARIABLE_REQUIRED',
      gcp_project: 'api-for-warp-drive',
      display_name: 'Victory36 MOCOA Service Account',
      project_number: '859242575175',
      service_token: 'use_gcp_application_default_credentials',
      elevenlabs_api_key: 'projects/api-for-warp-drive/secrets/elevenlabs-api-key/versions/latest',
      voice_id: 'pNInz6obpgDQGcFmaJgB',
      provider: 'elevenlabs',
      full_authentication: true,
      q_rix_enabled: true,
      code_execution_enabled: true,
      interface_modification_enabled: true,
      gcp_secret_manager: 'projects/api-for-warp-drive/secrets/victory36-credentials/versions/latest',
      authenticated_via_gcloud: true
    };
    
    const drClaudeServiceAccount = {
      account: 'drclaude.live',
      service_account_email: 'dr-claude-automationENVIRONMENT_VARIABLE_REQUIRED',
      gcp_project: 'api-for-warp-drive',
      display_name: 'Dr. Claude Automation',
      project_number: '859242575175',
      service_token: 'use_gcp_application_default_credentials',
      elevenlabs_api_key: 'projects/api-for-warp-drive/secrets/elevenlabs-api-key/versions/latest',
      anthropic_api_key: 'projects/api-for-warp-drive/secrets/anthropic-api-key/versions/latest',
      voice_id: '21m00Tcm4TlvDq8ikWAM',
      provider: 'elevenlabs',
      full_authentication: true,
      sh_rix_enabled: true,
      code_execution_enabled: true,
      interface_modification_enabled: true,
      gcp_secret_manager: 'projects/api-for-warp-drive/secrets/dr-claude-credentials/versions/latest',
      authenticated_via_gcloud: true
    };
    
    // RIX Voice Configuration with Service Accounts
    const rixVoiceConfig = {
      'QB': {
        name: 'Dr. Lucy',
        service_account: drLucyServiceAccount,
        voice_name: 'dana',
        provider: 'openai',
        model: 'tts-1-hd',
        accent: 'american_professional',
        api_endpoint: 'https://api.openai.com/v1/audio/speech'
      },
      'Q': {
        name: 'Victory 36',
        voice_id: 'pNInz6obpgDQGcFmaJgB', // 11 Labs with French accent
        accent: 'french_english',
        provider: 'elevenlabs',
        model: 'eleven_multilingual_v2',
        language: 'en-US', // English with French accent
        stability: 0.8,
        similarity_boost: 0.9,
        api_endpoint: 'https://api.elevenlabs.io/v1/text-to-speech'
      },
      'SH': {
        name: 'Dr. Claude', 
        voice_id: '21m00Tcm4TlvDq8ikWAM', // 11 Labs MATURE MAN (Southeast English)
        accent: 'southeast_english',
        provider: 'elevenlabs',
        model: 'eleven_multilingual_v2',
        language: 'en-GB',
        stability: 0.7,
        similarity_boost: 0.8,
        api_endpoint: 'https://api.elevenlabs.io/v1/text-to-speech'
      }
    };
    
    // RIX Activation Function with Service Account Authentication
    function activateRIX(rixType, name) {
      activeRIX = rixType;
      
      // Check Dr. Lucy's service account authentication for QB RIX
      if (rixType === 'QB' && !drLucyServiceAccount.full_authentication) {
        console.error('❌ Dr. Lucy service account authentication required');
        return;
      }
      
      // Remove active class from all hex items
      document.querySelectorAll('.copilot-hex-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Add active class to clicked item
      const targetHex = document.querySelector(`[onclick*="activateRIX('${rixType}', '${name}')"]`);
      if (targetHex) {
        targetHex.classList.add('active');
      }
      
      // Update active RIX display with voice info
      const voiceConfig = rixVoiceConfig[rixType];
      const activeDisplay = document.getElementById('activeRixDisplay');
      const activeDisplayMobile = document.getElementById('activeRixDisplayMobile');
      
      let displayText = `${rixType} RIX Active`;
      let voiceInfo = '';
      
      if (rixType === 'QB') {
        voiceInfo = 'OpenAI Dana';
      } else if (rixType === 'Q') {
        voiceInfo = 'French accent';
      } else if (rixType === 'SH') {
        voiceInfo = 'Southeast English';
      }
      
      if (activeDisplay) {
        activeDisplay.innerHTML = `${displayText}<br><small style="color: #888; font-size: 8px;">${voiceInfo}</small>`;
      }
      if (activeDisplayMobile) {
        activeDisplayMobile.innerHTML = `${displayText}<br><small style="color: #888; font-size: 8px;">${voiceInfo}</small>`;
      }
      
      // Initialize voice synthesis for selected RIX
      initializeRIXVoice(rixType, voiceConfig);
      
      // Log activation with service account info
      if (rixType === 'QB') {
        console.log(`✅ Dr. Lucy (QB RIX) activated with service account: ${drLucyServiceAccount.account}`);
        console.log(`🎙️ Voice: OpenAI Dana (${voiceConfig.model})`);
      } else {
        console.log(`✅ ${rixType} RIX (${name}) activated with ${voiceConfig.accent} voice`);
      }
    }
    
    // Initialize specific RIX voice synthesis and authenticate with GCP
    async function initializeRIXVoice(rixType, config) {
      console.log(`🎙️ Initializing ${config.name} voice synthesis...`);
      
      // Store active voice config globally
      window.activeVoiceConfig = config;
      
      if (rixType === 'QB') {
        console.log(`👩‍⚕️ Dr. Lucy (drlucy.live) initialized with OpenAI Dana voice`);
        console.log(`🔑 Service account: ${drLucyServiceAccount.service_account_email}`);
        console.log(`☁️ GCP Project: ${drLucyServiceAccount.gcp_project}`);
        console.log(`🛡️ Code execution enabled: ${drLucyServiceAccount.code_execution_enabled}`);
        console.log(`⚙️ Interface modification enabled: ${drLucyServiceAccount.interface_modification_enabled}`);
        
        // Authenticate Dr. Lucy's service account
        await authenticatePCPServiceAccount('QB', drLucyServiceAccount);
        
      } else if (rixType === 'Q') {
        console.log(`🇫🇷 Victory 36 (victory36.ag) initialized with French accent (English speech)`);
        console.log(`🔑 Service account: ${victory36ServiceAccount.service_account_email}`);
        console.log(`☁️ GCP Project: ${victory36ServiceAccount.gcp_project}`);
        console.log(`🛡️ Code execution enabled: ${victory36ServiceAccount.code_execution_enabled}`);
        
        // Authenticate Victory 36's service account
        await authenticatePCPServiceAccount('Q', victory36ServiceAccount);
        
      } else if (rixType === 'SH') {
        console.log(`🇬🇧 Dr. Claude (drclaude.live) initialized with Southeast English accent`);
        console.log(`🔑 Service account: ${drClaudeServiceAccount.service_account_email}`);
        console.log(`☁️ GCP Project: ${drClaudeServiceAccount.gcp_project}`);
        console.log(`🛡️ Code execution enabled: ${drClaudeServiceAccount.code_execution_enabled}`);
        
        // Authenticate Dr. Claude's service account
        await authenticatePCPServiceAccount('SH', drClaudeServiceAccount);
      }
    }
    
    // Authenticate PCP service accounts with GCP
    async function authenticatePCPServiceAccount(rixType, serviceAccount) {
      try {
        console.log(`🔐 Authenticating ${rixType} RIX service account with GCP...`);
        
        // In production, this would authenticate with GCP Secret Manager
        const authResponse = await fetch('/api/auth/service-account', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${serviceAccount.service_token}`
          },
          body: JSON.stringify({
            service_account_email: serviceAccount.service_account_email,
            gcp_project: serviceAccount.gcp_project,
            secret_manager_path: serviceAccount.gcp_secret_manager,
            rix_type: rixType,
            capabilities: {
              code_execution: serviceAccount.code_execution_enabled,
              interface_modification: serviceAccount.interface_modification_enabled,
              voice_synthesis: true
            }
          })
        });
        
        if (authResponse.ok) {
          const authData = await authResponse.json();
          console.log(`✅ ${rixType} RIX authenticated successfully`);
          console.log(`🎯 Capabilities: Code execution, Interface modification, Voice synthesis`);
          
          // Store authentication token for PCP operations
          window[`${rixType.toLowerCase()}AuthToken`] = authData.access_token;
          
          return true;
        } else {
          console.warn(`⚠️ ${rixType} RIX authentication failed, using fallback mode`);
          return false;
        }
        
      } catch (error) {
        console.error(`❌ ${rixType} RIX authentication error:`, error);
        console.log(`🔄 ${rixType} RIX operating in fallback mode`);
        return false;
      }
    }
    
    // PCP Code Execution Function - Allows PCPs to write and implement code
    async function executePCPCode(rixType, codeRequest) {
      const serviceAccounts = {
        'QB': drLucyServiceAccount,
        'Q': victory36ServiceAccount,
        'SH': drClaudeServiceAccount
      };
      
      const serviceAccount = serviceAccounts[rixType];
      if (!serviceAccount || !serviceAccount.code_execution_enabled) {
        console.error(`❌ Code execution not enabled for ${rixType} RIX`);
        return { error: 'Code execution not authorized' };
      }
      
      try {
        console.log(`💻 ${rixType} RIX executing code request...`);
        
        const response = await fetch('/api/pcp/execute-code', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${serviceAccount.service_token}`,
            'X-Service-Account': serviceAccount.service_account_email,
            'X-RIX-Type': rixType
          },
          body: JSON.stringify({
            code: codeRequest.code,
            language: codeRequest.language || 'javascript',
            context: codeRequest.context || 'interface_improvement',
            interface_target: 'mocoa-owner-interface',
            safety_check: true
          })
        });
        
        if (response.ok) {
          const result = await response.json();
          console.log(`✅ ${rixType} RIX code executed successfully`);
          
          // If the code modifies the interface, apply changes
          if (result.interface_changes) {
            await applyInterfaceChanges(result.interface_changes, rixType);
          }
          
          return result;
        } else {
          console.error(`❌ ${rixType} RIX code execution failed`);
          return { error: 'Code execution failed' };
        }
        
      } catch (error) {
        console.error(`❌ ${rixType} RIX code execution error:`, error);
        return { error: error.message };
      }
    }
    
    // Apply interface changes made by PCPs
    async function applyInterfaceChanges(changes, rixType) {
      console.log(`🔧 Applying interface changes from ${rixType} RIX...`);
      
      try {
        // Apply CSS changes
        if (changes.css) {
          const styleElement = document.createElement('style');
          styleElement.id = `pcp-${rixType.toLowerCase()}-styles`;
          styleElement.textContent = changes.css;
          document.head.appendChild(styleElement);
          console.log(`🎨 CSS changes applied by ${rixType} RIX`);
        }
        
        // Apply JavaScript changes
        if (changes.javascript) {
          // Execute JavaScript in safe context
          const script = document.createElement('script');
          script.id = `pcp-${rixType.toLowerCase()}-script`;
          script.textContent = changes.javascript;
          document.head.appendChild(script);
          console.log(`⚡ JavaScript changes applied by ${rixType} RIX`);
        }
        
        // Apply HTML changes
        if (changes.html) {
          // Apply HTML changes to designated areas
          changes.html.forEach(change => {
            const targetElement = document.getElementById(change.target_id);
            if (targetElement) {
              if (change.action === 'replace') {
                targetElement.innerHTML = change.content;
              } else if (change.action === 'append') {
                targetElement.insertAdjacentHTML('beforeend', change.content);
              }
              console.log(`📄 HTML changes applied to ${change.target_id} by ${rixType} RIX`);
            }
          });
        }
        
        console.log(`✅ All interface changes applied successfully by ${rixType} RIX`);
        
      } catch (error) {
        console.error(`❌ Error applying interface changes from ${rixType} RIX:`, error);
      }
    }
    
    // Enhanced sendCopilotMessage with QB integration
    function sendCopilotMessage() {
      const input = document.getElementById('copilotInput');
      const messagesContainer = document.getElementById('copilotMessages');
      
      if (!input || !messagesContainer || !input.value.trim()) return;
      
      const userMessage = input.value.trim();
      input.value = '';
      
      // Add user message
      addMessage(messagesContainer, userMessage, 'user');
      
      // Show QB is responding
      showNotification('QB is thinking...', 'success');
      
      // Process message with QB response
      setTimeout(() => {
        let response;
        const lowerMessage = userMessage.toLowerCase();
        
        if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
          response = `Hello! I'm QB (Dr. Lucy sRIX), your Professional Copilot. I'm ready to help you with communication, automation, growth, and ROI optimization. What would you like to work on today?`;
        } else if (lowerMessage.includes('status')) {
          response = `Testament Swarm Status: All 11 VLS solutions operational with 320,000+ active agents. Ready to assist with your ${activeRIX} specialist needs.`;
        } else {
          response = processSwarmQuery(userMessage);
        }
        
        addMessage(messagesContainer, response, 'copilot');
        showNotification('QB responded!', 'success');
      }, 1000);
    }
    
    // Voice Recognition & Speech Synthesis System for Dr. Lucy QB RIX
    let recognition = null;
    let isListening = false;
    let isSpeaking = false;
    let speechSynthesis = window.speechSynthesis;
    let drLucyVoice = null;
    let conversationMode = false;
    
    // Initialize Speech Synthesis for Dr. Lucy's Voice (Dana Voice)
    function initializeDrLucyVoice() {
      if ('speechSynthesis' in window) {
        
        function selectDrLucyVoice() {
          const voices = speechSynthesis.getVoices();
          console.log('🔍 Loading voices...', voices.length, 'voices available');
          console.log('📋 All available voices:', voices.map(v => `${v.name} (${v.lang}) [${v.localService ? 'Local' : 'Remote'}]`));
          
          // Primary: Look for Dana voice (case insensitive)
          drLucyVoice = voices.find(voice => 
            voice.name.toLowerCase().includes('dana') ||
            voice.name.toLowerCase().includes('dana (premium)') ||
            voice.name.toLowerCase().includes('dana voice') ||
            voice.name === 'Dana'
          );
          
          if (drLucyVoice) {
            console.log('✅ Found Dana voice:', drLucyVoice.name);
            showNotification(`🎙️ Dr. Lucy ready with Dana voice: ${drLucyVoice.name}`, 'success');
            return true;
          }
          
          // Secondary: Look for high-quality female voices
          const femaleVoices = [
            'Allison', 'Samantha', 'Victoria', 'Susan', 'Karen', 'Ava', 'Serena', 'Zoe',
            'Fiona', 'Moira', 'Tessa', 'Veena', 'Alex (Female)', 'Google UK English Female',
            'Microsoft Zira', 'Microsoft Hazel', 'Google US English', 'Whisper'
          ];
          
          for (const voiceName of femaleVoices) {
            drLucyVoice = voices.find(voice => 
              voice.name.includes(voiceName) ||
              voice.name.toLowerCase().includes(voiceName.toLowerCase())
            );
            if (drLucyVoice) {
              console.log('✅ Selected premium female voice:', drLucyVoice.name);
              showNotification(`🎙️ Dr. Lucy ready with ${drLucyVoice.name} voice`, 'success');
              return true;
            }
          }
          
          // Fallback: Any English female voice
          drLucyVoice = voices.find(voice => 
            voice.lang.startsWith('en') && 
            (voice.name.toLowerCase().includes('female') || 
             voice.gender === 'female' ||
             voice.name.toLowerCase().includes('woman'))
          );
          
          if (drLucyVoice) {
            console.log('⚡ Selected English female voice:', drLucyVoice.name);
            showNotification(`🎙️ Dr. Lucy ready with ${drLucyVoice.name}`, 'success');
            return true;
          }
          
          // Final fallback: Best available English voice
          drLucyVoice = voices.find(voice => voice.lang.startsWith('en')) || voices[0];
          
          if (drLucyVoice) {
            console.log('🔧 Fallback voice selected:', drLucyVoice.name);
            showNotification(`🎙️ Dr. Lucy ready with fallback voice: ${drLucyVoice.name}`, 'success');
            return true;
          }
          
          console.error('❌ No suitable voice found!');
          showNotification('⚠️ No voice available for Dr. Lucy', 'error');
          return false;
        }
        
        // Event-based voice loading
        speechSynthesis.addEventListener('voiceschanged', selectDrLucyVoice);
        
        // Multiple loading attempts for reliability
        setTimeout(selectDrLucyVoice, 100);
        setTimeout(selectDrLucyVoice, 500);
        setTimeout(selectDrLucyVoice, 1000);
        
        // User interaction trigger
        document.addEventListener('click', selectDrLucyVoice, { once: true });
        document.addEventListener('keydown', selectDrLucyVoice, { once: true });
        
        // Test voice immediately if already loaded
        if (speechSynthesis.getVoices().length > 0) {
          selectDrLucyVoice();
        }
        
        // Make selectDrLucyVoice globally available for debugging
        window.selectDrLucyVoice = selectDrLucyVoice;
        
        return true;
      } else {
        showNotification('Text-to-speech not supported in this browser', 'error');
        return false;
      }
    }
    
    // Dr. Lucy speaks a message using OpenAI Dana voice (primary)
    function speakMessage(text) {
      console.log('🗣️ speakMessage called with:', text, 'using OpenAI Dana voice');
      
      if (isSpeaking) {
        console.log('⚠️ Already speaking, stopping current speech');
        stopSpeaking();
        setTimeout(() => speakMessage(text), 100);
        return;
      }
      
      // Use OpenAI Dana voice (primary for Dr. Lucy)
      isSpeaking = true;
      
      // Call Cloudflare Voice Synthesis Service
      fetch('https://voice.asoos2100.cool/api/synthesize', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          text: text,
          voice: 'dana',
          provider: 'openai',
          model: 'tts-hd',
          quality: 'enterprise'
        })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`OpenAI TTS API error: ${response.status}`);
        }
        return response.blob();
      })
      .then(audioBlob => {
        const audioUrl = URL.createObjectURL(audioBlob);
        const audio = new Audio(audioUrl);
        
        audio.onloadstart = () => {
          console.log('🎙️ Dr. Lucy (OpenAI Dana) voice loading...');
          showNotification('🎙️ Dr. Lucy speaking with Dana voice...', 'success');
        };
        
        audio.onplay = () => {
          console.log('✅ OpenAI Dana voice playing');
        };
        
        audio.onended = () => {
          console.log('✅ OpenAI Dana voice finished');
          isSpeaking = false;
          URL.revokeObjectURL(audioUrl);
          if (conversationMode && recognition && !isListening) {
            startListening();
          }
        };
        
        audio.onerror = (error) => {
          console.error('❌ OpenAI Dana voice playback error:', error);
          isSpeaking = false;
          URL.revokeObjectURL(audioUrl);
          // Fallback to 11 Labs if OpenAI Dana fails
          speakMessage11LabsFallback(text);
        };
        
        audio.play();
      })
      .catch(error => {
        console.error('❌ OpenAI Dana TTS error:', error);
        isSpeaking = false;
        showNotification('⚠️ Using 11 Labs fallback', 'error');
        // Fallback to 11 Labs
        speakMessage11LabsFallback(text);
      });
    }
    
    // OpenAI TTS fallback when 11 Labs fails
    function speakMessageOpenAIFallback(text) {
      console.log('🔄 Using OpenAI TTS fallback for:', text);
      
      // Call OpenAI TTS API with Dana voice as fallback
      fetch('/api/speech/tts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          text: text,
          voice: 'dana',
          provider: 'openai',
          model: 'tts-hd',
          quality: 'enterprise'
        })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`OpenAI TTS API error: ${response.status}`);
        }
        return response.blob();
      })
      .then(audioBlob => {
        const audioUrl = URL.createObjectURL(audioBlob);
        const audio = new Audio(audioUrl);
        
        audio.onloadstart = () => {
          console.log('🎙️ OpenAI Dana voice loading...');
          showNotification('🎙️ Dr. Lucy speaking via OpenAI Dana...', 'success');
        };
        
        audio.onplay = () => {
          console.log('✅ OpenAI Dana voice playing');
        };
        
        audio.onended = () => {
          console.log('✅ OpenAI Dana voice finished');
          isSpeaking = false;
          URL.revokeObjectURL(audioUrl);
          if (conversationMode && recognition && !isListening) {
            startListening();
          }
        };
        
        audio.onerror = (error) => {
          console.error('❌ OpenAI Dana voice playback error:', error);
          isSpeaking = false;
          URL.revokeObjectURL(audioUrl);
          // Final fallback to browser TTS
          speakMessageFallback(text);
        };
        
        audio.play();
      })
      .catch(error => {
        console.error('❌ OpenAI TTS fallback error:', error);
        isSpeaking = false;
        showNotification('⚠️ Using browser voice fallback', 'error');
        // Final fallback to browser TTS
        speakMessageFallback(text);
      });
    }
    
    // Final fallback speech using browser synthesis
    function speakMessageFallback(text) {
      console.log('🔄 Using fallback browser voice for:', text);
      
      if (!speechSynthesis) {
        console.error('❌ speechSynthesis not available');
        showNotification('❌ Speech synthesis not available', 'error');
        return;
      }
      
      // Ensure we have voices loaded
      const voices = speechSynthesis.getVoices();
      console.log('🔊 Available fallback voices count:', voices.length);
      
      if (!drLucyVoice && voices.length > 0) {
        console.log('🔄 Re-initializing fallback voice...');
        selectDrLucyVoice(); // Re-initialize if voice isn't set
      }
      
      const utterance = new SpeechSynthesisUtterance(text);
      
      // Configure Dr. Lucy's voice with fallbacks
      if (drLucyVoice) {
        utterance.voice = drLucyVoice;
        console.log('🎙️ Using fallback voice:', drLucyVoice.name);
      } else {
        console.log('⚠️ No drLucyVoice set, using default fallback');
        // Try to find best available voice
        const bestVoice = voices.find(v => 
          v.name.includes('Samantha') || 
          v.name.includes('Karen') || 
          v.name.includes('Moira')
        );
        if (bestVoice) {
          utterance.voice = bestVoice;
          drLucyVoice = danaVoice;
          console.log('🎯 Found Dana voice on-demand:', danaVoice.name);
        }
      }
      
      // Professional voice settings
      utterance.rate = 0.85; // Slightly slower for clarity
      utterance.pitch = 1.0; // Natural pitch
      utterance.volume = 0.9; // Clear volume
      utterance.lang = 'en-US';
      
      utterance.onstart = function() {
        isSpeaking = true;
        console.log('✅ Speech synthesis started');
        showNotification(`🗣️ Dr. Lucy speaking with ${utterance.voice ? utterance.voice.name : 'default voice'}`, 'success');
      };
      
      utterance.onend = function() {
        isSpeaking = false;
        console.log('✅ Speech synthesis ended');
        
        // If in conversation mode, automatically start listening for the next input
        if (conversationMode) {
          setTimeout(() => {
            startVoiceInput();
          }, 500);
        }
      };
      
      utterance.onerror = function(event) {
        console.error('❌ Speech synthesis error:', event.error);
        isSpeaking = false;
        showNotification(`❌ Speech error: ${event.error}`, 'error');
      };
      
      console.log('🚀 Starting speech synthesis...');
      try {
        speechSynthesis.speak(utterance);
      } catch (error) {
        console.error('❌ Error calling speechSynthesis.speak():', error);
        showNotification('❌ Failed to start speech synthesis', 'error');
        isSpeaking = false;
      }
    }
    
    // Stop current speech (for OpenAI TTS Dana voice)
    function stopSpeaking() {
      console.log('🛑 Stopping current speech...');
      
      // Stop browser speech synthesis (fallback)
      if (speechSynthesis) {
        speechSynthesis.cancel();
      }
      
      // Stop any playing audio elements (OpenAI TTS)
      const audioElements = document.querySelectorAll('audio');
      audioElements.forEach(audio => {
        if (!audio.paused) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
      
      isSpeaking = false;
      console.log('✅ Speech stopped');
    }
    
    // Contextual greeting messages based on dashboard state
    function getContextualGreeting() {
      const hour = new Date().getHours();
      let timeGreeting = "Hello";
      
      if (hour < 12) {
        timeGreeting = "Good morning";
      } else if (hour < 17) {
        timeGreeting = "Good afternoon";
      } else {
        timeGreeting = "Good evening";
      }
      
      // Check dashboard context and build contextual greeting
      const contextualGreetings = [
        `${timeGreeting}! I see we have 5 projects in progress. Ready to review today's priorities?`,
        `${timeGreeting}! You have 5 scan-to-dos pending. Shall we work through them together?`,
        `${timeGreeting}! I have 5 hot tips ready for optimizing your workflow today.`,
        `${timeGreeting}! Everything looks organized. What would you like to work on next?`,
        `${timeGreeting}! I notice your revenue pipeline is up 47% - excellent progress! What's our next focus?`,
        `${timeGreeting}! Your team objectives are 85% complete. Ready to tackle the remaining items?`,
        `${timeGreeting}! The Testament Swarm shows all systems operational. How can I assist you today?`
      ];
      
      // Return random contextual greeting
      return contextualGreetings[Math.floor(Math.random() * contextualGreetings.length)];
    }
    
    // Auto-activate conversation mode on page load
    function autoActivateConversationMode() {
      conversationMode = true;
      
      // Update conversation button to show it's active
      const conversationBtn = document.getElementById('conversationModeBtn');
      if (conversationBtn) {
        conversationBtn.style.background = 'rgba(80, 200, 120, 0.2)';
        conversationBtn.style.borderColor = 'rgba(80, 200, 120, 0.4)';
        conversationBtn.style.color = '#50C878';
        conversationBtn.title = 'Conversation mode ON - Click to disable';
        conversationBtn.innerHTML = '🟢';
      }
      
      console.log('🎙️ Conversation mode auto-activated');
      
      // Dr. Lucy greets user automatically with context
      setTimeout(() => {
        const greeting = getContextualGreeting();
        console.log('Dr. Lucy contextual greeting:', greeting);
        speakMessage(greeting);
      }, 2000); // 2 second delay to let page fully load
    }
    
    // Toggle conversation mode (continuous back-and-forth)
    function toggleConversationMode() {
      conversationMode = !conversationMode;
      
      if (conversationMode) {
        console.log('🎙️ Conversation mode ON - Dr. Lucy will respond with voice and listen continuously');
        
        // Update conversation button visual feedback
        const conversationBtn = document.getElementById('conversationModeBtn');
        if (conversationBtn) {
          conversationBtn.style.background = 'rgba(80, 200, 120, 0.2)';
          conversationBtn.style.borderColor = 'rgba(80, 200, 120, 0.4)';
          conversationBtn.style.color = '#50C878';
          conversationBtn.title = 'Conversation mode ON - Click to disable';
          conversationBtn.innerHTML = '🟢';
        }
        
        // Only greet if manually activated (not auto-activated)
        if (!window.conversationAutoActivated) {
          setTimeout(() => {
            const greeting = getContextualGreeting();
            console.log('Dr. Lucy contextual greeting:', greeting);
            speakMessage(greeting);
          }, 800);
        }
        
      } else {
        console.log('🎙️ Conversation mode OFF');
        
        // Update conversation button visual feedback
        const conversationBtn = document.getElementById('conversationModeBtn');
        if (conversationBtn) {
          conversationBtn.style.background = 'rgba(255, 215, 0, 0.1)';
          conversationBtn.style.borderColor = 'rgba(255, 215, 0, 0.2)';
          conversationBtn.style.color = '#FFD700';
          conversationBtn.title = 'Toggle voice conversation mode';
          conversationBtn.innerHTML = '🗣️';
        }
        
        // Stop any current speech and listening
        speechSynthesis.cancel();
        if (recognition && isListening) {
          recognition.stop();
        }
        stopSpeaking();
      }
    }
    
    function initializeVoiceRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = 'en-US';
        
        recognition.onstart = function() {
          isListening = true;
          updateVoiceButton(true);
          showNotification('🎤 Dr. Lucy is listening...', 'success');
        };
        
        recognition.onresult = function(event) {
          let finalTranscript = '';
          let interimTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          // Update input field with interim results
          const input = document.getElementById('copilotInput');
          if (input) {
            input.value = finalTranscript || interimTranscript;
          }
          
          // If we have a final result, send it to Dr. Lucy
          if (finalTranscript) {
            setTimeout(() => {
              sendCopilotMessage();
            }, 500);
          }
        };
        
        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          isListening = false;
          updateVoiceButton(false);
          
          let errorMessage = 'Voice recognition error';
          if (event.error === 'not-allowed') {
            errorMessage = 'Microphone access denied. Please allow microphone permission and try again.';
          } else if (event.error === 'no-speech') {
            errorMessage = 'No speech detected. Please try speaking again.';
          }
          
          showNotification(errorMessage, 'error');
        };
        
        recognition.onend = function() {
          isListening = false;
          updateVoiceButton(false);
          if (!recognition.finalResult) {
            showNotification('🎤 Voice input complete', 'success');
          }
        };
        
        return true;
      } else {
        showNotification('Voice recognition not supported in this browser', 'error');
        return false;
      }
    }
    
    function startVoiceInput() {
      if (!recognition) {
        if (!initializeVoiceRecognition()) {
          return;
        }
      }
      
      if (isListening) {
        recognition.stop();
        return;
      }
      
      // Clear the input field
      const input = document.getElementById('copilotInput');
      if (input) {
        input.value = '';
        input.placeholder = 'Listening... speak now to Dr. Lucy';
      }
      
      try {
        recognition.start();
        showNotification('🎤 Speak to Dr. Lucy (QB RIX)...', 'success');
      } catch (error) {
        console.error('Error starting voice recognition:', error);
        isListening = false;
        updateVoiceButton(false);
        showNotification('Error starting voice recognition. Please try again.', 'error');
      }
    }
    
    function updateVoiceButton(listening) {
      const voiceButtons = document.querySelectorAll('[onclick="startVoiceInput()"]');
      
      voiceButtons.forEach(button => {
        if (listening) {
          button.style.background = 'rgba(239, 68, 68, 0.3)';
          button.style.borderColor = '#ef4444';
          button.style.animation = 'pulse 1s infinite';
          button.innerHTML = `
            <svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #ef4444;">
              <use href="#icon-microphone"></use>
            </svg>
          `;
          button.title = 'Click to stop listening';
        } else {
          button.style.background = 'rgba(255, 255, 255, 0.1)';
          button.style.borderColor = 'rgba(255, 255, 255, 0.2)';
          button.style.animation = 'none';
          button.innerHTML = `
            <svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #ffffff;">
              <use href="#icon-microphone"></use>
            </svg>
          `;
          button.title = 'Click to speak to Dr. Lucy';
          
          // Reset input placeholder
          const input = document.getElementById('copilotInput');
          if (input) {
            input.placeholder = 'Ask Dr. Lucy anything...';
          }
        }
      });
    }
    
    // Initialize voice recognition when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize voice recognition (but don't start it yet)
      setTimeout(() => {
        initializeVoiceRecognition();
      }, 1000);
    });
    
    // Missing functions for proper functionality
    function loadUserPreferences() {
      // Load user preferences from localStorage or API
      console.log('Loading user preferences...');
    }
    
    function initializeKeyboardShortcuts() {
      // Add keyboard shortcuts
      document.addEventListener('keydown', function(event) {
        if (event.ctrlKey && event.key === 'k') {
          event.preventDefault();
          document.getElementById('copilotInput')?.focus();
        }
      });
    }
    
    function loadDynamicContent() {
      // Load any dynamic content
      console.log('Initializing real-time data...');
    }
    
    function togglePanel(button) {
      const content = button.parentElement.querySelector('.panel-content');
      const chevron = button.querySelector('.chevron-icon');
      
      if (content && chevron) {
        if (content.classList.contains('active')) {
          content.classList.remove('active');
          chevron.style.transform = 'rotate(-90deg)';
          button.classList.add('collapsed');
        } else {
          content.classList.add('active');
          chevron.style.transform = 'rotate(0deg)';
          button.classList.remove('collapsed');
        }
      }
    }
    
    function toggleScanToApprove(button) {
      button.style.transform = 'scale(0.95)';
      setTimeout(() => {
        button.style.transform = 'scale(1)';
        showNotification('Scan to Approve activated - Processing workflow items', 'success');
      }, 100);
    }
    
    // Make functions globally available BEFORE DOM loads
    window.startVoiceInput = startVoiceInput;
    window.showNotification = showNotification;
    window.togglePanel = togglePanel;
    window.toggleScanToApprove = toggleScanToApprove;
    window.speakMessage = speakMessage;
    window.toggleConversationMode = toggleConversationMode;
    
    // Add missing functions that buttons are calling
    window.activateRIX = function(type, name) {
      console.log('Activating RIX:', type, name);
      showNotification(`Activating ${name} (${type} RIX)`, 'success');
    };
    
    window.toggleCopilotMode = function() {
      const chatArea = document.getElementById('naturalLanguageChat');
      const cliArea = document.getElementById('cliInterface');
      const btn = document.getElementById('modeToggleBtn');
      
      if (chatArea && cliArea && btn) {
        if (chatArea.style.display === 'none') {
          chatArea.style.display = 'flex';
          cliArea.style.display = 'none';
          btn.innerHTML = '<svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #8b5cf6;"><use href="#icon-terminal"></use></svg>CLI';
          btn.title = 'Switch to CLI Mode';
        } else {
          chatArea.style.display = 'none';
          cliArea.style.display = 'flex';
          btn.innerHTML = '<svg class="enterprise-icon" style="width: 10px; height: 10px; fill: #8b5cf6;"><use href="#icon-comments"></use></svg>Chat';
          btn.title = 'Switch to Chat Mode';
        }
      }
    };
    
    window.sendCopilotMessage = function() {
      const input = document.getElementById('copilotInput');
      if (input && input.value.trim()) {
        showNotification('Message sent: ' + input.value.trim(), 'success');
        input.value = '';
      }
    };
    
    window.handleCopilotKeyPress = function(event) {
      if (event.key === 'Enter') {
        sendCopilotMessage();
      }
    };
  </script>
</body>
</html>
